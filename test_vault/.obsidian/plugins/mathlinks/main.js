/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin:
https://github.com/zhaoshenzhai/obsidian-mathlinks
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getOwnPropSymbols = Object.getOwnPropertySymbols;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __propIsEnum = Object.prototype.propertyIsEnumerable;
var __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;
var __spreadValues = (a, b) => {
  for (var prop in b || (b = {}))
    if (__hasOwnProp.call(b, prop))
      __defNormalProp(a, prop, b[prop]);
  if (__getOwnPropSymbols)
    for (var prop of __getOwnPropSymbols(b)) {
      if (__propIsEnum.call(b, prop))
        __defNormalProp(a, prop, b[prop]);
    }
  return a;
};
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);
var __async = (__this, __arguments, generator) => {
  return new Promise((resolve, reject) => {
    var fulfilled = (value) => {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    };
    var rejected = (value) => {
      try {
        step(generator.throw(value));
      } catch (e) {
        reject(e);
      }
    };
    var step = (x) => x.done ? resolve(x.value) : Promise.resolve(x.value).then(fulfilled, rejected);
    step((generator = generator.apply(__this, __arguments)).next());
  });
};

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => MathLinks
});
module.exports = __toCommonJS(main_exports);
var import_obsidian8 = require("obsidian");

// src/settings/settings.ts
var DEFAULT_SETTINGS = {
  templates: [],
  excludedPaths: [],
  blockPrefix: "^",
  enableFileNameBlockLinks: true,
  enableAPI: true
};

// src/settings/tab.ts
var import_obsidian3 = require("obsidian");

// src/settings/modals.ts
var import_obsidian2 = require("obsidian");

// src/utils.ts
var import_obsidian = require("obsidian");
function isExcluded(plugin, file) {
  for (let i = 0; i < plugin.settings.excludedPaths.length; i++) {
    let excluded = plugin.app.vault.getAbstractFileByPath(plugin.settings.excludedPaths[i]);
    if (excluded && isEqualToOrChildOf(file, excluded))
      return false;
  }
  return true;
}
function translateLink(targetLink) {
  var _a;
  function translateLinkImpl(targetLink2, pattern) {
    let result = pattern.exec(targetLink2);
    if (result)
      return (result[1] ? `${result[1]} > ` : "") + `${result[2]}`;
  }
  let headingPattern = /(^.*)#([^\^].*)/;
  let blockPattern = /(^.*)#(\^[a-zA-Z0-9\-]+)/;
  let translatedAsHeading = translateLinkImpl(targetLink, headingPattern);
  let translatedAsBlock = translateLinkImpl(targetLink, blockPattern);
  return (_a = translatedAsHeading != null ? translatedAsHeading : translatedAsBlock) != null ? _a : "";
}
function isEqualToOrChildOf(file1, file2) {
  if (file1 == file2)
    return true;
  if (file2 instanceof import_obsidian.TFolder && file2.isRoot())
    return true;
  let ancestor = file1.parent;
  while (true) {
    if (ancestor == file2)
      return true;
    if (ancestor) {
      if (ancestor.isRoot())
        return false;
      ancestor = ancestor.parent;
    }
  }
}

// src/settings/modals.ts
var TemplatesModal = class extends import_obsidian2.Modal {
  constructor(app, plugin) {
    super(app);
    this.plugin = plugin;
  }
  onOpen() {
    this.display();
  }
  display() {
    return __async(this, null, function* () {
      const { contentEl } = this;
      contentEl.empty();
      contentEl.createEl("h4", { text: "Add/Edit Templates" });
      new import_obsidian2.Setting(contentEl).setName(createFragment((e) => {
        e.createSpan({ text: "The templates in the list below are sorted by precedence, with the top being replaced first. Note that " });
        e.createEl("code", { text: "a" });
        e.createSpan({ text: " > " });
        e.createEl("code", { text: "b" });
        e.createSpan({ text: " followed by " });
        e.createEl("code", { text: "b" });
        e.createSpan({ text: " > " });
        e.createEl("code", { text: "c" });
        e.createSpan({ text: " together is equivalent to " });
        e.createEl("code", { text: "a" });
        e.createSpan({ text: " > " });
        e.createEl("code", { text: "c" });
        e.createSpan({ text: ", but not the other way around." });
      })).addButton((btn) => {
        btn.setTooltip("Add").setIcon("plus").onClick((event) => {
          let newTemplate = { replaced: "", replacement: "", globalMatch: true, sensitive: true, word: true };
          new TemplateSettingsModal(this.app, this.plugin, this, newTemplate, true).open();
        });
      });
      if (this.plugin.settings.templates.length) {
        let list = contentEl.createEl("ul");
        for (let i = 0; i < this.plugin.settings.templates.length; i++) {
          let template = this.plugin.settings.templates[i];
          let item = list.createEl("li").createDiv();
          new import_obsidian2.Setting(item).setName(createFragment((e) => {
            e.createEl("code", { text: template.replaced });
            e.createSpan({ text: " > " });
            e.createEl("code", { text: template.replacement });
          })).addExtraButton((button) => {
            return button.setTooltip("Move up").setIcon("up-arrow-with-tail").onClick(() => __async(this, null, function* () {
              if (i != 0) {
                let down = __spreadValues({}, template);
                let up = this.plugin.settings.templates[i - 1];
                this.plugin.settings.templates[i] = up;
                this.plugin.settings.templates[i - 1] = down;
                yield this.plugin.saveSettings().then(() => {
                  this.display();
                });
              }
            }));
          }).addExtraButton((button) => {
            return button.setTooltip("Move down").setIcon("down-arrow-with-tail").onClick(() => __async(this, null, function* () {
              if (i != this.plugin.settings.templates.length - 1) {
                let up = __spreadValues({}, template);
                let down = this.plugin.settings.templates[i + 1];
                this.plugin.settings.templates[i] = down;
                this.plugin.settings.templates[i + 1] = up;
                yield this.plugin.saveSettings().then(() => {
                  this.display();
                });
              }
            }));
          }).addExtraButton((button) => {
            return button.setTooltip("Edit").setIcon("edit").onClick(() => __async(this, null, function* () {
              let modal = new TemplateSettingsModal(this.app, this.plugin, this, template, false);
              modal.open();
              modal.onClose = () => __async(this, null, function* () {
                yield this.plugin.saveSettings().then(() => {
                  this.display();
                });
              });
            }));
          }).addExtraButton((button) => {
            return button.setTooltip("Remove").setIcon("x").onClick(() => __async(this, null, function* () {
              this.plugin.settings.templates.remove(template);
              yield this.plugin.saveSettings().then(() => {
                this.display();
              });
            }));
          });
        }
      }
    });
  }
};
var TemplateSettingsModal = class extends import_obsidian2.Modal {
  constructor(app, plugin, modal, template, create) {
    super(app);
    this.plugin = plugin;
    this.modal = modal;
    this.template = template;
    this.create = create;
  }
  onOpen() {
    this.display();
  }
  display() {
    return __async(this, null, function* () {
      const { contentEl } = this;
      contentEl.empty();
      let replacedText;
      new import_obsidian2.Setting(contentEl).setName("Match for...").setDesc("String to be matched and replaced. Do not include regex.").addText((text) => {
        replacedText = text;
        replacedText.setValue(this.template.replaced).onChange((current) => {
          this.template.replaced = current;
        });
      });
      let replacementText;
      new import_obsidian2.Setting(contentEl).setName("Replace with...").setDesc("String to replace matches. Do not escape backslashes.").addText((text) => {
        replacementText = text;
        replacementText.setValue(this.template.replacement).onChange((current) => {
          this.template.replacement = current;
        });
      });
      new import_obsidian2.Setting(contentEl).setName("Global match").setDesc("Match all instances (instead of just the first).").addToggle((toggle) => {
        toggle.setValue(this.template.globalMatch).onChange((current) => this.template.globalMatch = current);
      });
      new import_obsidian2.Setting(contentEl).setName("Case sensitive").setDesc("Matches will be case sensitive.").addToggle((toggle) => {
        toggle.setValue(this.template.sensitive).onChange((current) => this.template.sensitive = current);
      });
      new import_obsidian2.Setting(contentEl).setName("Match whole words").setDesc("Only match whole words.").addToggle((toggle) => {
        toggle.setValue(this.template.word).onChange((current) => this.template.word = current);
      });
      new import_obsidian2.Setting(contentEl).addButton((b) => {
        b.setTooltip(this.create ? "Add" : "Save").setIcon("checkmark").onClick(() => __async(this, null, function* () {
          if (this.template.replaced == "") {
            new import_obsidian2.Notice("MathLinks: Please enter a non-empty string to be replaced");
          } else {
            if (this.create)
              this.plugin.settings.templates.push(this.template);
            yield this.plugin.saveSettings().then(() => {
              this.close();
              this.modal.display();
            });
          }
        }));
      }).addExtraButton((b) => {
        b.setTooltip("Cancel").setIcon("cross").onClick(() => __async(this, null, function* () {
          this.close();
        }));
      });
    });
  }
};
var ExcludeModal = class extends import_obsidian2.Modal {
  constructor(app, plugin) {
    super(app);
    this.plugin = plugin;
  }
  onOpen() {
    this.display();
  }
  display() {
    return __async(this, null, function* () {
      const { contentEl } = this;
      contentEl.empty();
      contentEl.createEl("h4", { text: "Excluded files" });
      new import_obsidian2.Setting(contentEl).setName("The files/folders in this list will be ignored by MathLinks.").addButton((btn) => {
        btn.setTooltip("Add").setIcon("plus").onClick((event) => {
          new FileExcludeSuggestModal(this.app, this.plugin, this).open();
        });
      });
      if (this.plugin.settings.excludedPaths.length) {
        let list = contentEl.createEl("ul");
        for (let path of this.plugin.settings.excludedPaths) {
          let item = list.createEl("li").createDiv();
          new import_obsidian2.Setting(item).setName(path).addExtraButton((button) => {
            return button.setTooltip("Remove").setIcon("x").onClick(() => __async(this, null, function* () {
              this.plugin.settings.excludedPaths.remove(path);
              yield this.plugin.saveSettings().then(() => {
                this.display();
              });
            }));
          });
        }
      }
    });
  }
};
var FileSuggestModal = class extends import_obsidian2.FuzzySuggestModal {
  constructor(app, plugin) {
    super(app);
    this.plugin = plugin;
  }
  getItems() {
    return this.app.vault.getAllLoadedFiles().filter(this.filterCallback.bind(this));
  }
  getItemText(file) {
    return file.path;
  }
  filterCallback(abstractFile) {
    if (abstractFile instanceof import_obsidian2.TFile && abstractFile.extension != "md")
      return false;
    if (abstractFile instanceof import_obsidian2.TFolder && abstractFile.isRoot())
      return false;
    for (const path of this.plugin.settings.excludedPaths) {
      const file = this.app.vault.getAbstractFileByPath(path);
      if (file && isEqualToOrChildOf(abstractFile, file)) {
        return false;
      }
    }
    return true;
  }
};
var FileExcludeSuggestModal = class extends FileSuggestModal {
  constructor(app, plugin, modal) {
    super(app, plugin);
    this.modal = modal;
  }
  onChooseItem(file, evt) {
    return __async(this, null, function* () {
      this.plugin.settings.excludedPaths.push(file.path);
      yield this.plugin.saveSettings().then(() => {
        this.modal.display();
      });
    });
  }
};

// src/settings/tab.ts
var MathLinksSettingTab = class extends import_obsidian3.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    return __async(this, null, function* () {
      const { containerEl } = this;
      containerEl.empty();
      containerEl.createEl("h2", { text: "MathLinks Settings" });
      new import_obsidian3.Setting(containerEl).setName("Templates").setDesc(createFragment((e) => {
        e.createSpan({ text: "Generate mathLinks with a template. Use " });
        e.createEl("code", { text: "mathLink: auto" });
        e.createSpan({ text: " to use templates in a file." });
      })).addButton((button) => {
        return button.setButtonText("Manage").onClick(() => __async(this, null, function* () {
          let modal = new TemplatesModal(this.app, this.plugin);
          modal.open();
          modal.onClose = () => __async(this, null, function* () {
            yield this.plugin.saveSettings().then(() => {
              this.display();
            });
          });
        }));
      });
      new import_obsidian3.Setting(containerEl).setName("Excluded files").setDesc("Manage files/paths that MathLinks will ignore.").addButton((button) => {
        return button.setButtonText("Manage").onClick(() => __async(this, null, function* () {
          let modal = new ExcludeModal(this.app, this.plugin);
          modal.open();
          modal.onClose = () => __async(this, null, function* () {
            yield this.plugin.saveSettings().then(() => {
              this.display();
            });
          });
        }));
      });
      let prefix;
      new import_obsidian3.Setting(containerEl).setName("Edit prefix for block links").setDesc(createFragment((e) => {
        e.createSpan({ text: "Links like " });
        e.createEl("code", { text: "note#^block-id" });
        e.createSpan({ text: " will be rendered as" });
        if (this.plugin.settings.enableFileNameBlockLinks) {
          e.createEl("code", { text: "note > " + this.plugin.settings.blockPrefix + "block-id" });
        } else {
          e.createEl("code", { text: this.plugin.settings.blockPrefix + "block-id" });
        }
        e.createSpan({ text: "." });
      })).addText((text) => {
        prefix = text;
        prefix.setValue(this.plugin.settings.blockPrefix).onChange((current) => __async(this, null, function* () {
          this.plugin.settings.blockPrefix = current;
          yield this.plugin.saveSettings();
        }));
        prefix.setPlaceholder("No prefix (default: ^)");
      }).addToggle((toggle) => {
        toggle.setValue(this.plugin.settings.enableFileNameBlockLinks).onChange((value) => __async(this, null, function* () {
          this.plugin.settings.enableFileNameBlockLinks = value;
          yield this.plugin.saveSettings().then(() => {
            this.display();
          });
        }));
        toggle.setTooltip("Disable to ignore note name.");
      });
      new import_obsidian3.Setting(containerEl).setName("Enable MathLinks API").setDesc(createFragment((e) => {
        let accounts = this.plugin.apiAccounts;
        e.createSpan({ text: "Allow other community plugins to use MathLinks." });
        if (accounts.length) {
          let list = e.createEl("ul");
          for (let account of accounts) {
            list.createEl("li", { text: account.manifest.name });
          }
        }
      })).addToggle((toggle) => {
        toggle.setValue(this.plugin.settings.enableAPI).onChange((value) => __async(this, null, function* () {
          this.plugin.settings.enableAPI = value;
          yield this.plugin.saveSettings().then(() => {
            this.display();
          });
        }));
      });
    });
  }
};

// src/api/api.ts
var import_obsidian4 = require("obsidian");
var MathLinksAPIAccount = class {
  constructor(plugin, manifest, blockPrefix, prefixer) {
    this.plugin = plugin;
    this.manifest = manifest;
    this.blockPrefix = blockPrefix;
    this.prefixer = prefixer;
    this.metadataSet = /* @__PURE__ */ new Map();
  }
  get(file, blockID) {
    let metadata = this.metadataSet.get(file);
    if (metadata) {
      if (blockID === void 0) {
        return metadata["mathLink"];
      }
      let blocks = metadata["mathLink-blocks"];
      if (blocks) {
        return blocks[blockID];
      }
    }
  }
  update(file, newMetadata) {
    if (file.extension == "md") {
      this.metadataSet.set(file, Object.assign({}, this.metadataSet.get(file), newMetadata));
      informChange(this.plugin.app, "mathlinks:updated", this, file);
    } else {
      throw Error(`MathLinks API: ${this.manifest.name} passed a non-markdown file ${file.path} to update().`);
    }
  }
  delete(file, which) {
    let metadata = this.metadataSet.get(file);
    if (metadata) {
      if (which === void 0) {
        this.metadataSet.delete(file);
      } else if (which == "mathLink" || which == "mathLink-blocks") {
        if (metadata[which] !== void 0) {
          delete metadata[which];
        } else {
          throw Error(`MathLinks API: ${this.manifest.name} attempted to delete ${which} of ${file.path}, but it does not exist.`);
        }
      } else {
        let blocks = metadata["mathLink-blocks"];
        if (blocks && blocks[which] !== void 0) {
          delete blocks[which];
        } else {
          throw Error(`MathLinks API: ${this.manifest.name} attempted to delete mathLink-blocks for ${file.path}#^${which}", but it does not exist`);
        }
      }
    } else {
      throw Error(`MathLinks API: ${this.manifest.name} attempted to delete the MathLinks metadata of ${file.path}, but it does not exist.`);
    }
    informChange(this.plugin.app, "mathlinks:updated", this, file);
  }
};
function informChange(app, eventName, ...callbackArgs) {
  app.metadataCache.trigger(eventName, ...callbackArgs);
  app.workspace.iterateRootLeaves((leaf) => {
    var _a;
    if (leaf.view instanceof import_obsidian4.MarkdownView && leaf.view.getMode() == "source") {
      (_a = leaf.view.editor.cm) == null ? void 0 : _a.dispatch();
    }
  });
}

// src/links/reading.ts
var import_obsidian6 = require("obsidian");

// src/links/helper.ts
var import_obsidian5 = require("obsidian");
function setMathLink(source, mathLinkEl) {
  mathLinkEl.replaceChildren();
  const mathPattern = /\$(.*?[^\s])\$/g;
  let textFrom = 0, textTo = 0;
  let result;
  while ((result = mathPattern.exec(source)) !== null) {
    const mathString = result[1];
    textTo = result.index;
    if (textTo > textFrom)
      mathLinkEl.createSpan().replaceWith(source.slice(textFrom, textTo));
    const mathEl = (0, import_obsidian5.renderMath)(mathString, false);
    mathLinkEl.createSpan({ cls: ["math", "math-inline", "is-loaded"] }).replaceWith(mathEl);
    (0, import_obsidian5.finishRenderMath)();
    textFrom = mathPattern.lastIndex;
  }
  if (textFrom < source.length)
    mathLinkEl.createSpan().replaceWith(source.slice(textFrom));
}
function getMathLink(plugin, targetLink, sourcePath) {
  var _a, _b;
  let { path, subpath } = (0, import_obsidian5.parseLinktext)(targetLink);
  let file = plugin.app.metadataCache.getFirstLinkpathDest(path, sourcePath);
  if (!file)
    return "";
  let cache = plugin.app.metadataCache.getFileCache(file);
  if (!cache)
    return "";
  let subpathResult = (0, import_obsidian5.resolveSubpath)(cache, subpath);
  let mathLink = "";
  if (subpathResult) {
    mathLink = getMathLinkFromSubpath(path, subpathResult, cache.frontmatter, plugin.settings.blockPrefix, plugin.settings.enableFileNameBlockLinks ? null : "");
  } else if (path) {
    mathLink = (_a = cache.frontmatter) == null ? void 0 : _a.mathLink;
    if (mathLink == "auto") {
      mathLink = getMathLinkFromTemplates(plugin, file);
    }
  }
  if (!mathLink && plugin.settings.enableAPI) {
    const sourceFile = plugin.app.vault.getAbstractFileByPath(sourcePath);
    if (sourceFile instanceof import_obsidian5.TFile) {
      for (let account of plugin.apiAccounts) {
        const metadata = account.metadataSet.get(file);
        if (metadata) {
          if (subpathResult) {
            mathLink = getMathLinkFromSubpath(path, subpathResult, metadata, account.blockPrefix, account.prefixer(sourceFile, file, subpathResult));
          } else {
            mathLink = (_b = metadata["mathLink"]) != null ? _b : "";
          }
        }
        if (mathLink) {
          break;
        }
      }
    }
  }
  return mathLink;
}
function getMathLinkFromSubpath(linkpath, subpathResult, metadata, blockPrefix, prefix) {
  var _a, _b;
  let subMathLink = "";
  if (subpathResult.type == "heading") {
    subMathLink = subpathResult.current.heading;
  } else if (subpathResult.type == "block" && ((_a = metadata == null ? void 0 : metadata["mathLink-blocks"]) == null ? void 0 : _a[subpathResult.block.id])) {
    subMathLink = blockPrefix + metadata["mathLink-blocks"][subpathResult.block.id];
  }
  if (subMathLink) {
    if (prefix === null) {
      if (linkpath) {
        return ((_b = metadata == null ? void 0 : metadata["mathLink"]) != null ? _b : linkpath) + " > " + subMathLink;
      } else {
        return subMathLink;
      }
    } else {
      return prefix + subMathLink;
    }
  } else {
    return "";
  }
}
function getMathLinkFromTemplates(plugin, file) {
  let templates = plugin.settings.templates;
  let mathLink = file.name.replace(/\.md$/, "");
  for (let i = 0; i < templates.length; i++) {
    let replaced = new RegExp(templates[i].replaced);
    let replacement = templates[i].replacement;
    let flags = "";
    if (templates[i].globalMatch)
      flags += "g";
    if (!templates[i].sensitive)
      flags += "i";
    if (templates[i].word)
      replaced = RegExp(replaced.source.replace(/^/, "\\b").replace(/$/, "\\b"), flags);
    else
      replaced = RegExp(replaced.source, flags);
    mathLink = mathLink.replace(replaced, replacement);
  }
  return mathLink;
}

// src/links/reading.ts
var MathLinksRenderChild = class extends import_obsidian6.MarkdownRenderChild {
  constructor(containerEl, plugin, sourcePath, targetLink, displayText) {
    var _a;
    super(containerEl);
    this.plugin = plugin;
    this.sourcePath = sourcePath;
    this.targetLink = targetLink;
    this.displayText = displayText;
    this.targetFile = this.plugin.app.metadataCache.getFirstLinkpathDest((0, import_obsidian6.getLinkpath)(this.targetLink), this.sourcePath);
    this.mathLinkEl = this.containerEl.cloneNode(true);
    this.mathLinkEl.textContent = "";
    (_a = this.containerEl.parentNode) == null ? void 0 : _a.insertBefore(this.mathLinkEl, this.containerEl.nextSibling);
    this.mathLinkEl.classList.add("mathLink-internal-link");
    this.containerEl.classList.add("original-internal-link");
    this.containerEl.style.display = "none";
    this.getMathLink = this.setMathLinkGetter();
  }
  onload() {
    this.update();
    this.plugin.registerEvent(this.plugin.app.metadataCache.on("changed", (changedFile) => {
      if (!this.targetFile || this.targetFile == changedFile) {
        this.update();
      }
    }));
    this.plugin.registerEvent(this.plugin.app.metadataCache.on("mathlinks:updated", (apiAccount, changedFile) => {
      if (!this.targetFile || this.targetFile == changedFile) {
        this.update();
      }
    }));
    this.plugin.registerEvent(this.plugin.app.metadataCache.on("mathlinks:account-deleted", (apiAccount) => {
      this.update();
    }));
  }
  setMathLinkGetter() {
    var _a, _b;
    let getter = () => "";
    if (this.displayText != this.targetLink && this.displayText != translateLink(this.targetLink)) {
      getter = () => this.displayText;
    } else {
      if (this.displayText == ((_a = this.targetFile) == null ? void 0 : _a.name) || this.displayText == ((_b = this.targetFile) == null ? void 0 : _b.basename) || this.displayText == translateLink(this.targetLink)) {
        getter = () => getMathLink(this.plugin, this.targetLink, this.sourcePath);
      }
    }
    return getter;
  }
  update() {
    return __async(this, null, function* () {
      const mathLink = this.getMathLink();
      if (mathLink) {
        setMathLink(mathLink, this.mathLinkEl);
      } else {
        setMathLink(this.displayText, this.mathLinkEl);
      }
    });
  }
};
function generateMathLinks(plugin, element, context) {
  var _a, _b;
  for (let targetEl of element.querySelectorAll(".internal-link")) {
    if (targetEl.classList.contains("mathLink-internal-link")) {
      targetEl.remove();
      let queryResult = element.querySelector(".original-internal-link");
      if (queryResult) {
        targetEl = queryResult;
        targetEl.classList.remove("original-internal-link");
        targetEl.style.display = "";
      }
    }
    const targetDisplay = (_a = targetEl.textContent) == null ? void 0 : _a.trim().replace(/\.md/, "");
    if (targetDisplay != "" && !/math-inline is-loaded/.test(targetEl.innerHTML)) {
      const targetLink = (_b = targetEl.getAttribute("data-href")) == null ? void 0 : _b.replace(/\.md/, "");
      if (targetLink) {
        const targetFile = plugin.app.metadataCache.getFirstLinkpathDest((0, import_obsidian6.getLinkpath)(targetLink), context.sourcePath);
        if (targetDisplay && targetFile) {
          const child = new MathLinksRenderChild(targetEl, plugin, context.sourcePath, targetLink, targetDisplay);
          context.addChild(child);
        }
      }
    }
  }
}

// src/links/preview.ts
var import_language = require("@codemirror/language");
var import_state = require("@codemirror/state");
var import_view = require("@codemirror/view");
var import_obsidian7 = require("obsidian");

// src/links/supercharged.ts
function addSuperCharged(plugin, span, outLinkFile) {
  if (outLinkFile && plugin.app.plugins.enabledPlugins.has("supercharged-links-obsidian")) {
    let superCharged = getSuperCharged(plugin, outLinkFile);
    span.classList.add("data-link-icon");
    span.classList.add("data-link-icon-after");
    span.classList.add("data-link-text");
    span.setAttribute("data-link-path", outLinkFile.path);
    span.setAttribute("data-link-tags", superCharged[0]);
    for (let i = 0; i < superCharged[1].length; i++)
      span.setAttribute("data-link-" + superCharged[1][i][0], superCharged[1][i][1]);
  }
}
function getSuperCharged(plugin, file) {
  var _a, _b, _c;
  const data = (_a = plugin.app.plugins.plugins["supercharged-links-obsidian"]) == null ? void 0 : _a.settings;
  let tagArr = (_b = plugin.app.metadataCache.getFileCache(file)) == null ? void 0 : _b.tags;
  let tags = "";
  if (tagArr) {
    for (let i = 0; i < tagArr.length; i++)
      tags += tagArr[i].tag.replace(/#/, "") + " ";
    tags = tags.trimEnd();
  }
  let attributes = [];
  let frontmatter = (_c = plugin.app.metadataCache.getFileCache(file)) == null ? void 0 : _c.frontmatter;
  if (data) {
    for (let attr in frontmatter) {
      if (attr != "mathLink" && attr != "position") {
        let selectors = data.selectors;
        for (let i = 0; i < selectors.length; i++) {
          if (selectors[i].name == attr && selectors[i].value == frontmatter[attr]) {
            attributes.push([attr, frontmatter[attr]]);
          } else if (selectors[i].type == "tag" && selectors[i].value == frontmatter[attr] && data.targetTags) {
            attributes.push([attr, frontmatter[attr]]);
          }
        }
      }
    }
  }
  return [tags, attributes];
}

// src/links/preview.ts
function buildLivePreview(plugin, leaf) {
  let leafView = leaf.view;
  class MathWidget extends import_view.WidgetType {
    constructor(outLinkText, outLinkMathLink) {
      super();
      this.outLinkText = outLinkText;
      this.outLinkMathLink = outLinkMathLink;
    }
    toDOM() {
      let mathLink = document.createElement("span");
      setMathLink(this.outLinkMathLink, mathLink);
      mathLink.classList.add("cm-underline");
      mathLink.setAttribute("draggable", "true");
      let outLinkFile = plugin.app.metadataCache.getFirstLinkpathDest(this.outLinkText.replace(/#.*$/, ""), "");
      if (outLinkFile)
        addSuperCharged(plugin, mathLink, outLinkFile);
      let mathLinkWrapper = document.createElement("span");
      mathLinkWrapper.classList.add("cm-hmd-internal-link");
      mathLinkWrapper.appendChild(mathLink);
      let sourcePath = "";
      if (leafView.file) {
        sourcePath = leafView.file.path;
        if (sourcePath.endsWith(".canvas")) {
          for (let node of leafView.canvas.selection.values()) {
            sourcePath = node.filePath;
            break;
          }
        }
      }
      const targetFile = plugin.app.metadataCache.getFirstLinkpathDest((0, import_obsidian7.getLinkpath)(this.outLinkText), sourcePath);
      mathLinkWrapper.onclick = (evt) => {
        evt.preventDefault();
        if (targetFile) {
          plugin.app.workspace.openLinkText(this.outLinkText, sourcePath, import_obsidian7.Keymap.isModEvent(evt));
        } else {
          self.open(this.outLinkText, "_blank", "noreferrer");
        }
      };
      mathLinkWrapper.onmousedown = (evt) => {
        if (evt.button == 1) {
          evt.preventDefault();
        }
      };
      mathLinkWrapper.onauxclick = (evt) => {
        if (evt.button == 1) {
          if (targetFile) {
            plugin.app.workspace.openLinkText(this.outLinkText, sourcePath, true);
          } else {
            self.open(this.outLinkText, "_blank", "noreferrer");
          }
        }
      };
      return mathLinkWrapper;
    }
  }
  let viewPlugin = import_view.ViewPlugin.fromClass(class {
    constructor(view) {
      leafView = leaf.view;
      this.tryBuildingDecorations(view);
    }
    update(update) {
      this.tryBuildingDecorations(update.view);
    }
    tryBuildingDecorations(view) {
      this.decorations = import_view.Decoration.none;
      let editorView = leaf.getViewState();
      if (leaf.view instanceof import_obsidian7.MarkdownView && leaf.view.file instanceof import_obsidian7.TFile && isExcluded(plugin, leaf.view.file)) {
        let curView = leaf.view.editor.cm;
        if (curView == view && editorView.state.mode == "source" && !editorView.state.source) {
          this.decorations = this.buildDecorations(view);
        } else {
          this.decorations = import_view.Decoration.none;
        }
      } else if (leafView.canvas) {
        for (let node of leafView.canvas.selection.values()) {
          if (isExcluded(plugin, node.file)) {
            this.decorations = this.buildDecorations(view);
          }
        }
        plugin.app.workspace.iterateRootLeaves((otherLeaf) => {
          if (otherLeaf.view instanceof import_obsidian7.MarkdownView) {
            let otherView = otherLeaf.view.editor.cm;
            if (otherView == view) {
              this.decorations = import_view.Decoration.none;
            }
          }
        });
      }
    }
    buildDecorations(view) {
      let builder = new import_state.RangeSetBuilder();
      for (let { from, to } of view.visibleRanges) {
        let start = -1, end = -1, outLinkText = "", outLinkMathLink = "";
        (0, import_language.syntaxTree)(view.state).iterate({
          from,
          to,
          enter(node) {
            let name = node.type.name;
            if (name.contains("formatting-link_formatting-link-start")) {
              start = node.from;
            } else if (name.contains("formatting_formatting-link_link")) {
              if (start == -1)
                start = node.from;
            } else if (name.contains("has-alias")) {
              outLinkText += view.state.doc.sliceString(node.from, node.to);
              if (leafView.file && outLinkMathLink == outLinkText.replace(/\.md/, "")) {
                outLinkMathLink = getMathLink(plugin, outLinkText, leafView.file.path);
              }
            } else if (/string_url$/.test(name) && !name.contains("format")) {
              outLinkText += decodeURI(view.state.doc.sliceString(node.from, node.to));
              if (leafView.file && outLinkMathLink == outLinkText.replace(/\.md/, "")) {
                outLinkMathLink = getMathLink(plugin, outLinkText, leafView.file.path);
              }
            } else if (leafView.file && name.contains("hmd-internal-link") && !name.contains("alias")) {
              outLinkText += view.state.doc.sliceString(node.from, node.to);
              outLinkMathLink = getMathLink(plugin, outLinkText, leafView.file.path);
            } else if (name.contains("formatting-link-end") || name.contains("formatting-link-string")) {
              if (!name.contains("end") && end == -1) {
                end = -2;
              } else {
                end = node.to;
                let cursorRange = view.state.selection.main;
                if (start > cursorRange.to || end < cursorRange.from) {
                  if (outLinkText && outLinkMathLink) {
                    builder.add(start, end, import_view.Decoration.widget({
                      widget: new MathWidget(outLinkText, outLinkMathLink.replace(/\\\$/, "$"))
                    }));
                  }
                }
                start = -1;
                end = -1;
                outLinkText = "";
                outLinkMathLink = "";
              }
            } else if (!name.contains("pipe") && (name.contains("hmd-internal-link") && name.contains("alias") || name.contains("hmd-escape") && name.contains("link") || /^link/.test(name))) {
              outLinkMathLink += view.state.doc.sliceString(node.from, node.to);
              if (leafView.file && outLinkMathLink == outLinkText.replace(/\.md/, "")) {
                outLinkMathLink = getMathLink(plugin, outLinkText, leafView.file.path);
              }
            }
          }
        });
      }
      return builder.finish();
    }
  }, { decorations: (v) => v.decorations });
  return new Promise((resolve) => {
    resolve(viewPlugin);
  });
}

// src/main.ts
var MathLinks = class extends import_obsidian8.Plugin {
  onload() {
    return __async(this, null, function* () {
      yield this.loadSettings();
      yield (0, import_obsidian8.loadMathJax)();
      this.registerMarkdownPostProcessor((element, context) => {
        let file = this.app.vault.getAbstractFileByPath(context.sourcePath);
        if (file && isExcluded(this, file)) {
          generateMathLinks(this, element, context);
        }
      });
      this.app.workspace.onLayoutReady(() => {
        this.app.workspace.iterateRootLeaves((leaf) => {
          if (leaf.view instanceof import_obsidian8.FileView && leaf.view.file && isExcluded(this, leaf.view.file)) {
            buildLivePreview(this, leaf).then((livePreview) => {
              this.registerEditorExtension(livePreview);
            });
          }
        });
      });
      this.app.workspace.on("active-leaf-change", (leaf) => {
        if (leaf.view instanceof import_obsidian8.FileView && leaf.view.file && isExcluded(this, leaf.view.file)) {
          buildLivePreview(this, leaf).then((livePreview) => {
            this.registerEditorExtension(livePreview);
          });
        }
      });
      this.apiAccounts = [];
    });
  }
  getAPIAccount(userPlugin) {
    let account = this.apiAccounts.find((account2) => account2.manifest.id == userPlugin.manifest.id);
    if (account)
      return account;
    account = new MathLinksAPIAccount(this, userPlugin.manifest, DEFAULT_SETTINGS.blockPrefix, () => null);
    this.apiAccounts.push(account);
    return account;
  }
  loadSettings() {
    return __async(this, null, function* () {
      this.settings = Object.assign({}, DEFAULT_SETTINGS, yield this.loadData());
      this.addSettingTab(new MathLinksSettingTab(this.app, this));
    });
  }
  saveSettings() {
    return __async(this, null, function* () {
      yield this.saveData(this.settings);
    });
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL21haW4udHMiLCAic3JjL3NldHRpbmdzL3NldHRpbmdzLnRzIiwgInNyYy9zZXR0aW5ncy90YWIudHMiLCAic3JjL3NldHRpbmdzL21vZGFscy50cyIsICJzcmMvdXRpbHMudHMiLCAic3JjL2FwaS9hcGkudHMiLCAic3JjL2xpbmtzL3JlYWRpbmcudHMiLCAic3JjL2xpbmtzL2hlbHBlci50cyIsICJzcmMvbGlua3MvcHJldmlldy50cyIsICJzcmMvbGlua3Mvc3VwZXJjaGFyZ2VkLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJpbXBvcnQgeyBGaWxlVmlldywgUGx1Z2luLCBXb3Jrc3BhY2VMZWFmLCBsb2FkTWF0aEpheCB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgTWF0aExpbmtzU2V0dGluZ3MsIERFRkFVTFRfU0VUVElOR1MgfSBmcm9tIFwiLi9zZXR0aW5ncy9zZXR0aW5nc1wiO1xuaW1wb3J0IHsgTWF0aExpbmtzU2V0dGluZ1RhYiB9IGZyb20gXCIuL3NldHRpbmdzL3RhYlwiXG5pbXBvcnQgeyBNYXRoTGlua3NBUElBY2NvdW50IH0gZnJvbSBcIi4vYXBpL2FwaVwiO1xuaW1wb3J0IHsgZ2VuZXJhdGVNYXRoTGlua3MgfSBmcm9tIFwiLi9saW5rcy9yZWFkaW5nXCI7XG5pbXBvcnQgeyBidWlsZExpdmVQcmV2aWV3IH0gZnJvbSBcIi4vbGlua3MvcHJldmlld1wiO1xuaW1wb3J0IHsgaXNFeGNsdWRlZCB9IGZyb20gXCIuL3V0aWxzXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1hdGhMaW5rcyBleHRlbmRzIFBsdWdpbiB7XG4gICAgc2V0dGluZ3M6IE1hdGhMaW5rc1NldHRpbmdzO1xuICAgIGFwaUFjY291bnRzOiBNYXRoTGlua3NBUElBY2NvdW50W107XG5cbiAgICBhc3luYyBvbmxvYWQoKSB7XG4gICAgICAgIGF3YWl0IHRoaXMubG9hZFNldHRpbmdzKCk7XG4gICAgICAgIGF3YWl0IGxvYWRNYXRoSmF4KCk7XG5cbiAgICAgICAgLy8gTWFya2Rvd24gUG9zdCBQcm9jZXNzb3IgZm9yIHJlYWRpbmcgdmlld1xuICAgICAgICB0aGlzLnJlZ2lzdGVyTWFya2Rvd25Qb3N0UHJvY2Vzc29yKChlbGVtZW50LCBjb250ZXh0KSA9PiB7XG4gICAgICAgICAgICBsZXQgZmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChjb250ZXh0LnNvdXJjZVBhdGgpO1xuICAgICAgICAgICAgaWYgKGZpbGUgJiYgaXNFeGNsdWRlZCh0aGlzLCBmaWxlKSkge1xuICAgICAgICAgICAgICAgIGdlbmVyYXRlTWF0aExpbmtzKHRoaXMsIGVsZW1lbnQsIGNvbnRleHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBMaXZlLXByZXZpZXc7IHVwZGF0ZSBhbGwgd2hlbiBPYnNpZGlhbiBsYXVuY2hlc1xuICAgICAgICB0aGlzLmFwcC53b3Jrc3BhY2Uub25MYXlvdXRSZWFkeSgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmFwcC53b3Jrc3BhY2UuaXRlcmF0ZVJvb3RMZWF2ZXMoKGxlYWY6IFdvcmtzcGFjZUxlYWYpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAobGVhZi52aWV3IGluc3RhbmNlb2YgRmlsZVZpZXcgJiYgbGVhZi52aWV3LmZpbGUgJiYgaXNFeGNsdWRlZCh0aGlzLCBsZWFmLnZpZXcuZmlsZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgYnVpbGRMaXZlUHJldmlldyh0aGlzLCBsZWFmKS50aGVuKChsaXZlUHJldmlldykgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWdpc3RlckVkaXRvckV4dGVuc2lvbihsaXZlUHJldmlldyk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBMaXZlLXByZXZpZXc7IHVwZGF0ZSBvbiBsZWFmLWNoYW5nZVxuICAgICAgICB0aGlzLmFwcC53b3Jrc3BhY2Uub24oXCJhY3RpdmUtbGVhZi1jaGFuZ2VcIiwgKGxlYWY6IFdvcmtzcGFjZUxlYWYpID0+IHtcbiAgICAgICAgICAgIGlmIChsZWFmLnZpZXcgaW5zdGFuY2VvZiBGaWxlVmlldyAmJiBsZWFmLnZpZXcuZmlsZSAmJiBpc0V4Y2x1ZGVkKHRoaXMsIGxlYWYudmlldy5maWxlKSkge1xuICAgICAgICAgICAgICAgIGJ1aWxkTGl2ZVByZXZpZXcodGhpcywgbGVhZikudGhlbigobGl2ZVByZXZpZXcpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWdpc3RlckVkaXRvckV4dGVuc2lvbihsaXZlUHJldmlldyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuYXBpQWNjb3VudHMgPSBbXTtcbiAgICB9XG5cbiAgICBnZXRBUElBY2NvdW50PFVzZXJQbHVnaW4gZXh0ZW5kcyBQbHVnaW4+KHVzZXJQbHVnaW46IFJlYWRvbmx5PFVzZXJQbHVnaW4+KTogTWF0aExpbmtzQVBJQWNjb3VudCB7XG4gICAgICAgIGxldCBhY2NvdW50ID0gdGhpcy5hcGlBY2NvdW50cy5maW5kKChhY2NvdW50KSA9PiBhY2NvdW50Lm1hbmlmZXN0LmlkID09IHVzZXJQbHVnaW4ubWFuaWZlc3QuaWQpO1xuICAgICAgICBpZiAoYWNjb3VudCkgcmV0dXJuIGFjY291bnQ7XG5cbiAgICAgICAgYWNjb3VudCA9IG5ldyBNYXRoTGlua3NBUElBY2NvdW50KHRoaXMsIHVzZXJQbHVnaW4ubWFuaWZlc3QsIERFRkFVTFRfU0VUVElOR1MuYmxvY2tQcmVmaXgsICgpID0+IG51bGwpO1xuICAgICAgICB0aGlzLmFwaUFjY291bnRzLnB1c2goYWNjb3VudCk7XG4gICAgICAgIHJldHVybiBhY2NvdW50O1xuICAgIH1cblxuICAgIGFzeW5jIGxvYWRTZXR0aW5ncygpIHtcbiAgICAgICAgdGhpcy5zZXR0aW5ncyA9IE9iamVjdC5hc3NpZ24oe30sIERFRkFVTFRfU0VUVElOR1MsIGF3YWl0IHRoaXMubG9hZERhdGEoKSk7XG4gICAgICAgIHRoaXMuYWRkU2V0dGluZ1RhYihuZXcgTWF0aExpbmtzU2V0dGluZ1RhYih0aGlzLmFwcCwgdGhpcykpO1xuICAgIH1cblxuICAgIGFzeW5jIHNhdmVTZXR0aW5ncygpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5zYXZlRGF0YSh0aGlzLnNldHRpbmdzKTtcbiAgICB9XG59XG4iLCAiaW1wb3J0IHsgVEFic3RyYWN0RmlsZSB9IGZyb20gXCJvYnNpZGlhblwiO1xuXG5leHBvcnQgaW50ZXJmYWNlIE1hdGhMaW5rc1NldHRpbmdzIHtcbiAgICB0ZW1wbGF0ZXM6IFRlbXBsYXRlW107XG4gICAgZXhjbHVkZWRQYXRoczogc3RyaW5nW107XG4gICAgYmxvY2tQcmVmaXg6IHN0cmluZztcbiAgICBlbmFibGVGaWxlTmFtZUJsb2NrTGlua3M6IGJvb2xlYW47XG4gICAgZW5hYmxlQVBJOiBib29sZWFuO1xufVxuXG5leHBvcnQgdHlwZSBUZW1wbGF0ZSA9IHtcbiAgICByZXBsYWNlZDogc3RyaW5nO1xuICAgIHJlcGxhY2VtZW50OiBzdHJpbmc7XG4gICAgZ2xvYmFsTWF0Y2g6IGJvb2xlYW47XG4gICAgc2Vuc2l0aXZlOiBib29sZWFuO1xuICAgIHdvcmQ6IGJvb2xlYW47XG59XG5cbmV4cG9ydCBjb25zdCBERUZBVUxUX1NFVFRJTkdTOiBNYXRoTGlua3NTZXR0aW5ncyA9IHtcbiAgICB0ZW1wbGF0ZXM6IFtdLFxuICAgIGV4Y2x1ZGVkUGF0aHM6IFtdLFxuICAgIGJsb2NrUHJlZml4OiBcIl5cIixcbiAgICBlbmFibGVGaWxlTmFtZUJsb2NrTGlua3M6IHRydWUsXG4gICAgZW5hYmxlQVBJOiB0cnVlLFxufVxuIiwgImltcG9ydCB7IFNldHRpbmcsIFBsdWdpblNldHRpbmdUYWIsIE5vdGljZSwgQXBwIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBUZXh0Q29tcG9uZW50LCBEcm9wZG93bkNvbXBvbmVudCwgVG9nZ2xlQ29tcG9uZW50LCBCdXR0b25Db21wb25lbnQgfSBmcm9tIFwib2JzaWRpYW5cIlxuaW1wb3J0IHsgVGVtcGxhdGVzTW9kYWwsIEV4Y2x1ZGVNb2RhbCB9IGZyb20gXCIuL21vZGFsc1wiXG5pbXBvcnQgTWF0aExpbmtzIGZyb20gXCIuLi9tYWluXCJcblxuZXhwb3J0IGNsYXNzIE1hdGhMaW5rc1NldHRpbmdUYWIgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcHVibGljIHBsdWdpbjogTWF0aExpbmtzKSB7XG4gICAgICAgIHN1cGVyKGFwcCwgcGx1Z2luKTtcbiAgICB9XG5cbiAgICBhc3luYyBkaXNwbGF5KCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCB7IGNvbnRhaW5lckVsIH0gPSB0aGlzO1xuXG4gICAgICAgIGNvbnRhaW5lckVsLmVtcHR5KCk7XG4gICAgICAgIGNvbnRhaW5lckVsLmNyZWF0ZUVsKFwiaDJcIiwgeyB0ZXh0OiBcIk1hdGhMaW5rcyBTZXR0aW5nc1wiIH0pO1xuXG4gICAgICAgIC8vIFRlbXBsYXRlc1xuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKFwiVGVtcGxhdGVzXCIpXG4gICAgICAgICAgICAuc2V0RGVzYyhcbiAgICAgICAgICAgICAgICBjcmVhdGVGcmFnbWVudCgoZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBlLmNyZWF0ZVNwYW4oeyB0ZXh0OiBcIkdlbmVyYXRlIG1hdGhMaW5rcyB3aXRoIGEgdGVtcGxhdGUuIFVzZSBcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgZS5jcmVhdGVFbChcImNvZGVcIiwgeyB0ZXh0OiBcIm1hdGhMaW5rOiBhdXRvXCIgfSk7XG4gICAgICAgICAgICAgICAgICAgIGUuY3JlYXRlU3Bhbih7IHRleHQ6IFwiIHRvIHVzZSB0ZW1wbGF0ZXMgaW4gYSBmaWxlLlwiIH0pO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAuYWRkQnV0dG9uKChidXR0b246IEJ1dHRvbkNvbXBvbmVudCk6IEJ1dHRvbkNvbXBvbmVudCA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGJ1dHRvbi5zZXRCdXR0b25UZXh0KFwiTWFuYWdlXCIpLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBsZXQgbW9kYWwgPSBuZXcgVGVtcGxhdGVzTW9kYWwodGhpcy5hcHAsIHRoaXMucGx1Z2luKTtcbiAgICAgICAgICAgICAgICAgICAgbW9kYWwub3BlbigpO1xuICAgICAgICAgICAgICAgICAgICBtb2RhbC5vbkNsb3NlID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXNwbGF5KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEV4Y2x1ZGVkIGZpbGVzXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoXCJFeGNsdWRlZCBmaWxlc1wiKVxuICAgICAgICAgICAgLnNldERlc2MoXCJNYW5hZ2UgZmlsZXMvcGF0aHMgdGhhdCBNYXRoTGlua3Mgd2lsbCBpZ25vcmUuXCIpXG4gICAgICAgICAgICAuYWRkQnV0dG9uKChidXR0b246IEJ1dHRvbkNvbXBvbmVudCk6IEJ1dHRvbkNvbXBvbmVudCA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGJ1dHRvbi5zZXRCdXR0b25UZXh0KFwiTWFuYWdlXCIpLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBsZXQgbW9kYWwgPSBuZXcgRXhjbHVkZU1vZGFsKHRoaXMuYXBwLCB0aGlzLnBsdWdpbik7XG4gICAgICAgICAgICAgICAgICAgIG1vZGFsLm9wZW4oKTtcbiAgICAgICAgICAgICAgICAgICAgbW9kYWwub25DbG9zZSA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzcGxheSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAvLyBCbG9jayBsaW5rc1xuICAgICAgICBsZXQgcHJlZml4OiBUZXh0Q29tcG9uZW50O1xuICAgICAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgICAgICAgIC5zZXROYW1lKFwiRWRpdCBwcmVmaXggZm9yIGJsb2NrIGxpbmtzXCIpXG4gICAgICAgICAgICAuc2V0RGVzYyhcbiAgICAgICAgICAgICAgICBjcmVhdGVGcmFnbWVudCgoZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBlLmNyZWF0ZVNwYW4oeyB0ZXh0OiBcIkxpbmtzIGxpa2UgXCIgfSk7XG4gICAgICAgICAgICAgICAgICAgIGUuY3JlYXRlRWwoXCJjb2RlXCIsIHsgdGV4dDogXCJub3RlI15ibG9jay1pZFwiIH0pO1xuICAgICAgICAgICAgICAgICAgICBlLmNyZWF0ZVNwYW4oeyB0ZXh0OiBcIiB3aWxsIGJlIHJlbmRlcmVkIGFzXCIgfSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnBsdWdpbi5zZXR0aW5ncy5lbmFibGVGaWxlTmFtZUJsb2NrTGlua3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGUuY3JlYXRlRWwoXCJjb2RlXCIsIHsgdGV4dDogXCJub3RlID4gXCIgKyB0aGlzLnBsdWdpbi5zZXR0aW5ncy5ibG9ja1ByZWZpeCArIFwiYmxvY2staWRcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGUuY3JlYXRlRWwoXCJjb2RlXCIsIHsgdGV4dDogdGhpcy5wbHVnaW4uc2V0dGluZ3MuYmxvY2tQcmVmaXggKyBcImJsb2NrLWlkXCIgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZS5jcmVhdGVTcGFuKHsgdGV4dDogXCIuXCIgfSk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIC5hZGRUZXh0KCh0ZXh0KSA9PiB7XG4gICAgICAgICAgICAgICAgcHJlZml4ID0gdGV4dDtcbiAgICAgICAgICAgICAgICBwcmVmaXguc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuYmxvY2tQcmVmaXgpLm9uQ2hhbmdlKGFzeW5jIChjdXJyZW50OiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuYmxvY2tQcmVmaXggPSBjdXJyZW50O1xuICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBwcmVmaXguc2V0UGxhY2Vob2xkZXIoXCJObyBwcmVmaXggKGRlZmF1bHQ6IF4pXCIpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZTogVG9nZ2xlQ29tcG9uZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgdG9nZ2xlLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZUZpbGVOYW1lQmxvY2tMaW5rcylcbiAgICAgICAgICAgICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZTogYm9vbGVhbikgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZW5hYmxlRmlsZU5hbWVCbG9ja0xpbmtzID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc3BsYXkoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0b2dnbGUuc2V0VG9vbHRpcChcIkRpc2FibGUgdG8gaWdub3JlIG5vdGUgbmFtZS5cIik7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAvLyBFbmFibGUgQVBJXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgICAgICAgLnNldE5hbWUoXCJFbmFibGUgTWF0aExpbmtzIEFQSVwiKVxuICAgICAgICAgICAgLnNldERlc2MoXG4gICAgICAgICAgICAgICAgY3JlYXRlRnJhZ21lbnQoKGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGFjY291bnRzID0gdGhpcy5wbHVnaW4uYXBpQWNjb3VudHM7XG4gICAgICAgICAgICAgICAgICAgIGUuY3JlYXRlU3Bhbih7IHRleHQ6IFwiQWxsb3cgb3RoZXIgY29tbXVuaXR5IHBsdWdpbnMgdG8gdXNlIE1hdGhMaW5rcy5cIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFjY291bnRzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGxpc3QgPSBlLmNyZWF0ZUVsKFwidWxcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBhY2NvdW50IG9mIGFjY291bnRzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdC5jcmVhdGVFbChcImxpXCIsIHsgdGV4dDogYWNjb3VudC5tYW5pZmVzdC5uYW1lIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICkuYWRkVG9nZ2xlKCh0b2dnbGU6IFRvZ2dsZUNvbXBvbmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIHRvZ2dsZS5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5lbmFibGVBUEkpXG4gICAgICAgICAgICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWU6IGJvb2xlYW4pID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmVuYWJsZUFQSSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXNwbGF5KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pO1xuICAgIH1cbn1cbiIsICJpbXBvcnQgeyBTZXR0aW5nLCBNb2RhbCwgTm90aWNlLCBURmlsZSwgVEFic3RyYWN0RmlsZSwgVEZvbGRlciwgRnV6enlTdWdnZXN0TW9kYWwsIEFwcCB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgVGV4dENvbXBvbmVudCwgQnV0dG9uQ29tcG9uZW50LCBFeHRyYUJ1dHRvbkNvbXBvbmVudCB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgVGVtcGxhdGUgfSBmcm9tIFwiLi9zZXR0aW5nc1wiO1xuaW1wb3J0IHsgaXNFcXVhbFRvT3JDaGlsZE9mIH0gZnJvbSBcIi4uL3V0aWxzXCI7XG5pbXBvcnQgTWF0aExpbmtzIGZyb20gXCIuLi9tYWluXCJcblxuZXhwb3J0IGNsYXNzIFRlbXBsYXRlc01vZGFsIGV4dGVuZHMgTW9kYWwge1xuICAgIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwdWJsaWMgcGx1Z2luOiBNYXRoTGlua3MpIHtcbiAgICAgICAgc3VwZXIoYXBwKTtcbiAgICB9XG5cbiAgICBvbk9wZW4oKSB7XG4gICAgICAgIHRoaXMuZGlzcGxheSgpO1xuICAgIH1cblxuICAgIC8vIENyZWRpdHMgdG8gUnlvdGFVc2hpby9vYnNpZGlhbi1tYXRoLWJvb3N0ZXJcbiAgICBhc3luYyBkaXNwbGF5KCkge1xuICAgICAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICAgICAgY29udGVudEVsLmVtcHR5KCk7XG4gICAgICAgIGNvbnRlbnRFbC5jcmVhdGVFbChcImg0XCIsIHsgdGV4dDogXCJBZGQvRWRpdCBUZW1wbGF0ZXNcIiB9KTtcblxuICAgICAgICBuZXcgU2V0dGluZyhjb250ZW50RWwpXG4gICAgICAgICAgICAuc2V0TmFtZShcbiAgICAgICAgICAgICAgICBjcmVhdGVGcmFnbWVudCgoZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBlLmNyZWF0ZVNwYW4oeyB0ZXh0OiBcIlRoZSB0ZW1wbGF0ZXMgaW4gdGhlIGxpc3QgYmVsb3cgYXJlIHNvcnRlZCBieSBwcmVjZWRlbmNlLCB3aXRoIHRoZSB0b3AgYmVpbmcgcmVwbGFjZWQgZmlyc3QuIE5vdGUgdGhhdCBcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgZS5jcmVhdGVFbChcImNvZGVcIiwgeyB0ZXh0OiBcImFcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgZS5jcmVhdGVTcGFuKHsgdGV4dDogXCIgPiBcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgZS5jcmVhdGVFbChcImNvZGVcIiwgeyB0ZXh0OiBcImJcIiB9KTtcbiAgICAgICAgICAgICAgICAgICAgZS5jcmVhdGVTcGFuKHsgdGV4dDogXCIgZm9sbG93ZWQgYnkgXCIgfSk7XG4gICAgICAgICAgICAgICAgICAgIGUuY3JlYXRlRWwoXCJjb2RlXCIsIHsgdGV4dDogXCJiXCIgfSk7XG4gICAgICAgICAgICAgICAgICAgIGUuY3JlYXRlU3Bhbih7IHRleHQ6IFwiID4gXCIgfSk7XG4gICAgICAgICAgICAgICAgICAgIGUuY3JlYXRlRWwoXCJjb2RlXCIsIHsgdGV4dDogXCJjXCIgfSk7XG4gICAgICAgICAgICAgICAgICAgIGUuY3JlYXRlU3Bhbih7IHRleHQ6IFwiIHRvZ2V0aGVyIGlzIGVxdWl2YWxlbnQgdG8gXCIgfSk7XG4gICAgICAgICAgICAgICAgICAgIGUuY3JlYXRlRWwoXCJjb2RlXCIsIHsgdGV4dDogXCJhXCIgfSk7XG4gICAgICAgICAgICAgICAgICAgIGUuY3JlYXRlU3Bhbih7IHRleHQ6IFwiID4gXCIgfSk7XG4gICAgICAgICAgICAgICAgICAgIGUuY3JlYXRlRWwoXCJjb2RlXCIsIHsgdGV4dDogXCJjXCIgfSk7XG4gICAgICAgICAgICAgICAgICAgIGUuY3JlYXRlU3Bhbih7IHRleHQ6IFwiLCBidXQgbm90IHRoZSBvdGhlciB3YXkgYXJvdW5kLlwiIH0pO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAuYWRkQnV0dG9uKChidG4pID0+IHtcbiAgICAgICAgICAgICAgICBidG4uc2V0VG9vbHRpcChcIkFkZFwiKS5zZXRJY29uKFwicGx1c1wiKVxuICAgICAgICAgICAgICAgICAgICAub25DbGljaygoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBuZXdUZW1wbGF0ZTogVGVtcGxhdGUgPSB7IHJlcGxhY2VkOiBcIlwiLCByZXBsYWNlbWVudDogXCJcIiwgZ2xvYmFsTWF0Y2g6IHRydWUsIHNlbnNpdGl2ZTogdHJ1ZSwgd29yZDogdHJ1ZSB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFRlbXBsYXRlU2V0dGluZ3NNb2RhbCh0aGlzLmFwcCwgdGhpcy5wbHVnaW4sIHRoaXMsIG5ld1RlbXBsYXRlLCB0cnVlKS5vcGVuKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKHRoaXMucGx1Z2luLnNldHRpbmdzLnRlbXBsYXRlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGxldCBsaXN0ID0gY29udGVudEVsLmNyZWF0ZUVsKFwidWxcIik7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMucGx1Z2luLnNldHRpbmdzLnRlbXBsYXRlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGxldCB0ZW1wbGF0ZSA9IHRoaXMucGx1Z2luLnNldHRpbmdzLnRlbXBsYXRlc1tpXTtcbiAgICAgICAgICAgICAgICBsZXQgaXRlbSA9IGxpc3QuY3JlYXRlRWwoXCJsaVwiKS5jcmVhdGVEaXYoKTtcblxuICAgICAgICAgICAgICAgIG5ldyBTZXR0aW5nKGl0ZW0pXG4gICAgICAgICAgICAgICAgICAgIC5zZXROYW1lKFxuICAgICAgICAgICAgICAgICAgICAgICAgY3JlYXRlRnJhZ21lbnQoKGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLmNyZWF0ZUVsKFwiY29kZVwiLCB7IHRleHQ6IHRlbXBsYXRlLnJlcGxhY2VkIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuY3JlYXRlU3Bhbih7IHRleHQ6IFwiID4gXCIgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5jcmVhdGVFbChcImNvZGVcIiwgeyB0ZXh0OiB0ZW1wbGF0ZS5yZXBsYWNlbWVudCB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgLmFkZEV4dHJhQnV0dG9uKChidXR0b246IEV4dHJhQnV0dG9uQ29tcG9uZW50KTogRXh0cmFCdXR0b25Db21wb25lbnQgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJ1dHRvbi5zZXRUb29sdGlwKFwiTW92ZSB1cFwiKS5zZXRJY29uKFwidXAtYXJyb3ctd2l0aC10YWlsXCIpLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpICE9IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGRvd24gPSB7Li4udGVtcGxhdGV9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgdXAgPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy50ZW1wbGF0ZXNbaSAtIDFdO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnRlbXBsYXRlc1tpXSA9IHVwO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy50ZW1wbGF0ZXNbaSAtIDFdID0gZG93bjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc3BsYXkoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5hZGRFeHRyYUJ1dHRvbigoYnV0dG9uOiBFeHRyYUJ1dHRvbkNvbXBvbmVudCk6IEV4dHJhQnV0dG9uQ29tcG9uZW50ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBidXR0b24uc2V0VG9vbHRpcChcIk1vdmUgZG93blwiKS5zZXRJY29uKFwiZG93bi1hcnJvdy13aXRoLXRhaWxcIikub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkgIT0gdGhpcy5wbHVnaW4uc2V0dGluZ3MudGVtcGxhdGVzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHVwID0gey4uLnRlbXBsYXRlfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGRvd24gPSB0aGlzLnBsdWdpbi5zZXR0aW5ncy50ZW1wbGF0ZXNbaSArIDFdO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnRlbXBsYXRlc1tpXSA9IGRvd247XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLnRlbXBsYXRlc1tpKzFdID0gdXA7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXNwbGF5KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAuYWRkRXh0cmFCdXR0b24oKGJ1dHRvbjogRXh0cmFCdXR0b25Db21wb25lbnQpOiBFeHRyYUJ1dHRvbkNvbXBvbmVudCA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYnV0dG9uLnNldFRvb2x0aXAoXCJFZGl0XCIpLnNldEljb24oXCJlZGl0XCIpLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBtb2RhbCA9IG5ldyBUZW1wbGF0ZVNldHRpbmdzTW9kYWwodGhpcy5hcHAsIHRoaXMucGx1Z2luLCB0aGlzLCB0ZW1wbGF0ZSwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGFsLm9wZW4oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RhbC5vbkNsb3NlID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGlzcGxheSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5hZGRFeHRyYUJ1dHRvbigoYnV0dG9uOiBFeHRyYUJ1dHRvbkNvbXBvbmVudCk6IEV4dHJhQnV0dG9uQ29tcG9uZW50ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBidXR0b24uc2V0VG9vbHRpcChcIlJlbW92ZVwiKS5zZXRJY29uKFwieFwiKS5vbkNsaWNrKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy50ZW1wbGF0ZXMucmVtb3ZlKHRlbXBsYXRlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kaXNwbGF5KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmNsYXNzIFRlbXBsYXRlU2V0dGluZ3NNb2RhbCBleHRlbmRzIE1vZGFsIHtcbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcHVibGljIHBsdWdpbjogTWF0aExpbmtzLCBwdWJsaWMgbW9kYWw6IFRlbXBsYXRlc01vZGFsLCBwdWJsaWMgdGVtcGxhdGU6IFRlbXBsYXRlLCBwdWJsaWMgY3JlYXRlOiBib29sZWFuKSB7XG4gICAgICAgIHN1cGVyKGFwcCk7XG4gICAgfVxuXG4gICAgb25PcGVuKCkge1xuICAgICAgICB0aGlzLmRpc3BsYXkoKTtcbiAgICB9XG5cbiAgICBhc3luYyBkaXNwbGF5KCkge1xuICAgICAgICBjb25zdCB7IGNvbnRlbnRFbCB9ID0gdGhpcztcbiAgICAgICAgY29udGVudEVsLmVtcHR5KCk7XG5cbiAgICAgICAgbGV0IHJlcGxhY2VkVGV4dDogVGV4dENvbXBvbmVudDtcbiAgICAgICAgbmV3IFNldHRpbmcoY29udGVudEVsKVxuICAgICAgICAgICAgLnNldE5hbWUoXCJNYXRjaCBmb3IuLi5cIilcbiAgICAgICAgICAgIC5zZXREZXNjKFwiU3RyaW5nIHRvIGJlIG1hdGNoZWQgYW5kIHJlcGxhY2VkLiBEbyBub3QgaW5jbHVkZSByZWdleC5cIilcbiAgICAgICAgICAgIC5hZGRUZXh0KCh0ZXh0KSA9PiB7XG4gICAgICAgICAgICAgICAgcmVwbGFjZWRUZXh0ID0gdGV4dDtcbiAgICAgICAgICAgICAgICByZXBsYWNlZFRleHQuc2V0VmFsdWUodGhpcy50ZW1wbGF0ZS5yZXBsYWNlZCkub25DaGFuZ2UoKGN1cnJlbnQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50ZW1wbGF0ZS5yZXBsYWNlZCA9IGN1cnJlbnQ7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICBsZXQgcmVwbGFjZW1lbnRUZXh0OiBUZXh0Q29tcG9uZW50O1xuICAgICAgICBuZXcgU2V0dGluZyhjb250ZW50RWwpXG4gICAgICAgICAgICAuc2V0TmFtZShcIlJlcGxhY2Ugd2l0aC4uLlwiKVxuICAgICAgICAgICAgLnNldERlc2MoXCJTdHJpbmcgdG8gcmVwbGFjZSBtYXRjaGVzLiBEbyBub3QgZXNjYXBlIGJhY2tzbGFzaGVzLlwiKVxuICAgICAgICAgICAgLmFkZFRleHQoKHRleHQpID0+IHtcbiAgICAgICAgICAgICAgICByZXBsYWNlbWVudFRleHQgPSB0ZXh0O1xuICAgICAgICAgICAgICAgIHJlcGxhY2VtZW50VGV4dC5zZXRWYWx1ZSh0aGlzLnRlbXBsYXRlLnJlcGxhY2VtZW50KS5vbkNoYW5nZSgoY3VycmVudCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRlbXBsYXRlLnJlcGxhY2VtZW50ID0gY3VycmVudDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRlbnRFbClcbiAgICAgICAgICAgIC5zZXROYW1lKFwiR2xvYmFsIG1hdGNoXCIpXG4gICAgICAgICAgICAuc2V0RGVzYyhcIk1hdGNoIGFsbCBpbnN0YW5jZXMgKGluc3RlYWQgb2YganVzdCB0aGUgZmlyc3QpLlwiKVxuICAgICAgICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlKSA9PiB7XG4gICAgICAgICAgICAgICAgdG9nZ2xlLnNldFZhbHVlKHRoaXMudGVtcGxhdGUuZ2xvYmFsTWF0Y2gpLm9uQ2hhbmdlKChjdXJyZW50KSA9PiAodGhpcy50ZW1wbGF0ZS5nbG9iYWxNYXRjaCA9IGN1cnJlbnQpKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIG5ldyBTZXR0aW5nKGNvbnRlbnRFbClcbiAgICAgICAgICAgIC5zZXROYW1lKFwiQ2FzZSBzZW5zaXRpdmVcIilcbiAgICAgICAgICAgIC5zZXREZXNjKFwiTWF0Y2hlcyB3aWxsIGJlIGNhc2Ugc2Vuc2l0aXZlLlwiKVxuICAgICAgICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlKSA9PiB7XG4gICAgICAgICAgICAgICAgdG9nZ2xlLnNldFZhbHVlKHRoaXMudGVtcGxhdGUuc2Vuc2l0aXZlKS5vbkNoYW5nZSgoY3VycmVudCkgPT4gKHRoaXMudGVtcGxhdGUuc2Vuc2l0aXZlID0gY3VycmVudCkpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgbmV3IFNldHRpbmcoY29udGVudEVsKVxuICAgICAgICAgICAgLnNldE5hbWUoXCJNYXRjaCB3aG9sZSB3b3Jkc1wiKVxuICAgICAgICAgICAgLnNldERlc2MoXCJPbmx5IG1hdGNoIHdob2xlIHdvcmRzLlwiKVxuICAgICAgICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlKSA9PiB7XG4gICAgICAgICAgICAgICAgdG9nZ2xlLnNldFZhbHVlKHRoaXMudGVtcGxhdGUud29yZCkub25DaGFuZ2UoKGN1cnJlbnQpID0+ICh0aGlzLnRlbXBsYXRlLndvcmQgPSBjdXJyZW50KSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICBuZXcgU2V0dGluZyhjb250ZW50RWwpXG4gICAgICAgICAgICAuYWRkQnV0dG9uKChiKSA9PiB7XG4gICAgICAgICAgICAgICAgYi5zZXRUb29sdGlwKHRoaXMuY3JlYXRlID8gXCJBZGRcIiA6IFwiU2F2ZVwiKS5zZXRJY29uKFwiY2hlY2ttYXJrXCIpLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy50ZW1wbGF0ZS5yZXBsYWNlZCA9PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgTm90aWNlKFwiTWF0aExpbmtzOiBQbGVhc2UgZW50ZXIgYSBub24tZW1wdHkgc3RyaW5nIHRvIGJlIHJlcGxhY2VkXCIpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuY3JlYXRlKSB0aGlzLnBsdWdpbi5zZXR0aW5ncy50ZW1wbGF0ZXMucHVzaCh0aGlzLnRlbXBsYXRlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGFsLmRpc3BsYXkoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmFkZEV4dHJhQnV0dG9uKChiOiBFeHRyYUJ1dHRvbkNvbXBvbmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGIuc2V0VG9vbHRpcChcIkNhbmNlbFwiKS5zZXRJY29uKFwiY3Jvc3NcIikub25DbGljayhhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cbn1cblxuZXhwb3J0IGNsYXNzIEV4Y2x1ZGVNb2RhbCBleHRlbmRzIE1vZGFsIHtcbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcHVibGljIHBsdWdpbjogTWF0aExpbmtzKSB7XG4gICAgICAgIHN1cGVyKGFwcCk7XG4gICAgfVxuXG4gICAgb25PcGVuKCkge1xuICAgICAgICB0aGlzLmRpc3BsYXkoKTtcbiAgICB9XG5cbiAgICAvLyBDcmVkaXRzIHRvIFJ5b3RhVXNoaW8vb2JzaWRpYW4tbWF0aC1ib29zdGVyXG4gICAgYXN5bmMgZGlzcGxheSgpIHtcbiAgICAgICAgY29uc3QgeyBjb250ZW50RWwgfSA9IHRoaXM7XG4gICAgICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICAgICAgICBjb250ZW50RWwuY3JlYXRlRWwoXCJoNFwiLCB7IHRleHQ6IFwiRXhjbHVkZWQgZmlsZXNcIiB9KTtcblxuICAgICAgICBuZXcgU2V0dGluZyhjb250ZW50RWwpXG4gICAgICAgICAgICAuc2V0TmFtZShcIlRoZSBmaWxlcy9mb2xkZXJzIGluIHRoaXMgbGlzdCB3aWxsIGJlIGlnbm9yZWQgYnkgTWF0aExpbmtzLlwiKVxuICAgICAgICAgICAgLmFkZEJ1dHRvbigoYnRuKSA9PiB7XG4gICAgICAgICAgICAgICAgYnRuLnNldFRvb2x0aXAoXCJBZGRcIikuc2V0SWNvbihcInBsdXNcIilcbiAgICAgICAgICAgICAgICAgICAgLm9uQ2xpY2soKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgRmlsZUV4Y2x1ZGVTdWdnZXN0TW9kYWwodGhpcy5hcHAsIHRoaXMucGx1Z2luLCB0aGlzKS5vcGVuKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKHRoaXMucGx1Z2luLnNldHRpbmdzLmV4Y2x1ZGVkUGF0aHMubGVuZ3RoKSB7XG4gICAgICAgICAgICBsZXQgbGlzdCA9IGNvbnRlbnRFbC5jcmVhdGVFbChcInVsXCIpO1xuICAgICAgICAgICAgZm9yIChsZXQgcGF0aCBvZiB0aGlzLnBsdWdpbi5zZXR0aW5ncy5leGNsdWRlZFBhdGhzKSB7XG4gICAgICAgICAgICAgICAgbGV0IGl0ZW0gPSBsaXN0LmNyZWF0ZUVsKFwibGlcIikuY3JlYXRlRGl2KCk7XG4gICAgICAgICAgICAgICAgbmV3IFNldHRpbmcoaXRlbSkuc2V0TmFtZShwYXRoKS5hZGRFeHRyYUJ1dHRvbigoYnV0dG9uOiBFeHRyYUJ1dHRvbkNvbXBvbmVudCk6IEV4dHJhQnV0dG9uQ29tcG9uZW50ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJ1dHRvbi5zZXRUb29sdGlwKFwiUmVtb3ZlXCIpLnNldEljb24oXCJ4XCIpLm9uQ2xpY2soYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZXhjbHVkZWRQYXRocy5yZW1vdmUocGF0aCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRpc3BsYXkoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cblxuYWJzdHJhY3QgY2xhc3MgRmlsZVN1Z2dlc3RNb2RhbCBleHRlbmRzIEZ1enp5U3VnZ2VzdE1vZGFsPFRBYnN0cmFjdEZpbGU+IHtcbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcHVibGljIHBsdWdpbjogTWF0aExpbmtzKSB7XG4gICAgICAgIHN1cGVyKGFwcCk7XG4gICAgfVxuXG4gICAgZ2V0SXRlbXMoKTogVEFic3RyYWN0RmlsZVtdIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYXBwLnZhdWx0LmdldEFsbExvYWRlZEZpbGVzKCkuZmlsdGVyKHRoaXMuZmlsdGVyQ2FsbGJhY2suYmluZCh0aGlzKSk7XG4gICAgfVxuXG4gICAgZ2V0SXRlbVRleHQoZmlsZTogVEFic3RyYWN0RmlsZSk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiBmaWxlLnBhdGg7XG4gICAgfVxuXG4gICAgZmlsdGVyQ2FsbGJhY2soYWJzdHJhY3RGaWxlOiBUQWJzdHJhY3RGaWxlKTogYm9vbGVhbiB7XG4gICAgICAgIGlmIChhYnN0cmFjdEZpbGUgaW5zdGFuY2VvZiBURmlsZSAmJiBhYnN0cmFjdEZpbGUuZXh0ZW5zaW9uICE9IFwibWRcIikgcmV0dXJuIGZhbHNlO1xuICAgICAgICBpZiAoYWJzdHJhY3RGaWxlIGluc3RhbmNlb2YgVEZvbGRlciAmJiBhYnN0cmFjdEZpbGUuaXNSb290KCkpIHJldHVybiBmYWxzZTtcblxuICAgICAgICBmb3IgKGNvbnN0IHBhdGggb2YgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZXhjbHVkZWRQYXRocykge1xuICAgICAgICAgICAgY29uc3QgZmlsZSA9IHRoaXMuYXBwLnZhdWx0LmdldEFic3RyYWN0RmlsZUJ5UGF0aChwYXRoKVxuICAgICAgICAgICAgaWYgKGZpbGUgJiYgaXNFcXVhbFRvT3JDaGlsZE9mKGFic3RyYWN0RmlsZSwgZmlsZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbn1cblxuY2xhc3MgRmlsZUV4Y2x1ZGVTdWdnZXN0TW9kYWwgZXh0ZW5kcyBGaWxlU3VnZ2VzdE1vZGFsIHtcbiAgICBjb25zdHJ1Y3RvcihhcHA6IEFwcCwgcGx1Z2luOiBNYXRoTGlua3MsIHB1YmxpYyBtb2RhbDogRXhjbHVkZU1vZGFsKSB7XG4gICAgICAgIHN1cGVyKGFwcCwgcGx1Z2luKTtcbiAgICB9XG5cbiAgICBhc3luYyBvbkNob29zZUl0ZW0oZmlsZTogVEFic3RyYWN0RmlsZSwgZXZ0OiBNb3VzZUV2ZW50IHwgS2V5Ym9hcmRFdmVudCkge1xuICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5leGNsdWRlZFBhdGhzLnB1c2goZmlsZS5wYXRoKTtcbiAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLm1vZGFsLmRpc3BsYXkoKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuIiwgImltcG9ydCB7IFRBYnN0cmFjdEZpbGUsIFRGb2xkZXIgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCBNYXRoTGlua3MgZnJvbSBcIi4vbWFpblwiO1xuXG4vLyBDaGVjayBpZiBwYXRoIGlzIGV4Y2x1ZGVkXG5leHBvcnQgZnVuY3Rpb24gaXNFeGNsdWRlZChwbHVnaW46IE1hdGhMaW5rcywgZmlsZTogVEFic3RyYWN0RmlsZSk6IGJvb2xlYW4ge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGx1Z2luLnNldHRpbmdzLmV4Y2x1ZGVkUGF0aHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgbGV0IGV4Y2x1ZGVkID0gcGx1Z2luLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgocGx1Z2luLnNldHRpbmdzLmV4Y2x1ZGVkUGF0aHNbaV0pO1xuICAgICAgICBpZiAoZXhjbHVkZWQgJiYgaXNFcXVhbFRvT3JDaGlsZE9mKGZpbGUsIGV4Y2x1ZGVkKSkgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHJldHVybiB0cnVlO1xufVxuXG4vLyBDb252ZXJ0IFwiZmlsZW5hbWUjaGVhZGluZ1wiIHRvIFwiZmlsZW5hbWUgPiBoZWFkaW5nXCIgYW5kIFwiZmlsZW5hbWUjXmJsb2NrSURcIiB0byBcImZpbGVuYW1lID4gXmJsb2NrSURcIlxuZXhwb3J0IGZ1bmN0aW9uIHRyYW5zbGF0ZUxpbmsodGFyZ2V0TGluazogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBmdW5jdGlvbiB0cmFuc2xhdGVMaW5rSW1wbCh0YXJnZXRMaW5rOiBzdHJpbmcsIHBhdHRlcm46IFJlZ0V4cCk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG4gICAgICAgIGxldCByZXN1bHQgPSBwYXR0ZXJuLmV4ZWModGFyZ2V0TGluayk7XG4gICAgICAgIGlmIChyZXN1bHQpXG4gICAgICAgICAgICByZXR1cm4gKHJlc3VsdFsxXSA/IGAke3Jlc3VsdFsxXX0gPiBgIDogXCJcIikgKyBgJHtyZXN1bHRbMl19YFxuICAgIH1cblxuICAgIGxldCBoZWFkaW5nUGF0dGVybiA9IC8oXi4qKSMoW15cXF5dLiopLztcbiAgICBsZXQgYmxvY2tQYXR0ZXJuID0gLyheLiopIyhcXF5bYS16QS1aMC05XFwtXSspLztcbiAgICBsZXQgdHJhbnNsYXRlZEFzSGVhZGluZyA9IHRyYW5zbGF0ZUxpbmtJbXBsKHRhcmdldExpbmssIGhlYWRpbmdQYXR0ZXJuKTtcbiAgICBsZXQgdHJhbnNsYXRlZEFzQmxvY2sgPSB0cmFuc2xhdGVMaW5rSW1wbCh0YXJnZXRMaW5rLCBibG9ja1BhdHRlcm4pO1xuICAgIHJldHVybiB0cmFuc2xhdGVkQXNIZWFkaW5nID8/IHRyYW5zbGF0ZWRBc0Jsb2NrID8/IFwiXCI7XG59XG5cbi8vIEZyb20gaHR0cHM6Ly9naXRodWIuY29tL1J5b3RhVXNoaW8vb2JzaWRpYW4tbWF0aC1ib29zdGVyL2Jsb2IvbWFzdGVyL3NyYy91dGlscy50c1xuZXhwb3J0IGZ1bmN0aW9uIGlzRXF1YWxUb09yQ2hpbGRPZihmaWxlMTogVEFic3RyYWN0RmlsZSwgZmlsZTI6IFRBYnN0cmFjdEZpbGUpOiBib29sZWFuIHtcbiAgICBpZiAoZmlsZTEgPT0gZmlsZTIpIHJldHVybiB0cnVlO1xuICAgIGlmIChmaWxlMiBpbnN0YW5jZW9mIFRGb2xkZXIgJiYgZmlsZTIuaXNSb290KCkpIHJldHVybiB0cnVlO1xuXG4gICAgbGV0IGFuY2VzdG9yID0gZmlsZTEucGFyZW50O1xuICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgIGlmIChhbmNlc3RvciA9PSBmaWxlMikgcmV0dXJuIHRydWU7XG4gICAgICAgIGlmIChhbmNlc3Rvcikge1xuICAgICAgICAgICAgaWYgKGFuY2VzdG9yLmlzUm9vdCgpKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICBhbmNlc3RvciA9IGFuY2VzdG9yLnBhcmVudDtcbiAgICAgICAgfVxuICAgIH1cbn1cbiIsICJpbXBvcnQgeyBBcHAsIEJsb2NrU3VicGF0aFJlc3VsdCwgSGVhZGluZ1N1YnBhdGhSZXN1bHQsIE1hcmtkb3duVmlldywgUGx1Z2luTWFuaWZlc3QsIFRGaWxlLCBXb3Jrc3BhY2VMZWFmIH0gZnJvbSAnb2JzaWRpYW4nO1xuaW1wb3J0IE1hdGhMaW5rcyBmcm9tICcuLi9tYWluJztcblxuZXhwb3J0IGludGVyZmFjZSBNYXRoTGlua3NNZXRhZGF0YSB7XG4gICAgXCJtYXRoTGlua1wiPzogc3RyaW5nO1xuICAgIFwibWF0aExpbmstYmxvY2tzXCI/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+O1xufVxuXG5leHBvcnQgdHlwZSBNYXRoTGlua3NNZXRhZGF0YVNldCA9IE1hcDxURmlsZSwgTWF0aExpbmtzTWV0YWRhdGE+O1xuXG5leHBvcnQgY2xhc3MgTWF0aExpbmtzQVBJQWNjb3VudCB7XG4gICAgbWV0YWRhdGFTZXQ6IE1hdGhMaW5rc01ldGFkYXRhU2V0O1xuXG4gICAgY29uc3RydWN0b3IocHVibGljIHBsdWdpbjogTWF0aExpbmtzLCBwdWJsaWMgbWFuaWZlc3Q6IFJlYWRvbmx5PFBsdWdpbk1hbmlmZXN0PiwgcHVibGljIGJsb2NrUHJlZml4OiBzdHJpbmcsIHB1YmxpYyBwcmVmaXhlcjogKHNvdXJjZUZpbGU6IFRGaWxlLCB0YXJnZXRGaWxlOiBURmlsZSwgc3VicGF0aFJlc3VsdDogSGVhZGluZ1N1YnBhdGhSZXN1bHQgfCBCbG9ja1N1YnBhdGhSZXN1bHQpID0+IHN0cmluZyB8IG51bGwpIHtcbiAgICAgICAgdGhpcy5tZXRhZGF0YVNldCA9IG5ldyBNYXAoKTtcbiAgICB9XG5cbiAgICBnZXQoZmlsZTogVEZpbGUsIGJsb2NrSUQ/OiBzdHJpbmcpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICAgICAgICAvLyBJZiBibG9ja0lEID09PSB1bmRlZmluZWQsIHJldHVybiBtYXRoTGlua1xuICAgICAgICAvLyBJZiBibG9ja0lEIGlzIGdpdmVuLCByZXR1cm4gdGhlIGNvcnJlc3BvbmRpbmcgaXRlbSBvZiBtYXRoTGluay1ibG9ja3NcbiAgICAgICAgbGV0IG1ldGFkYXRhID0gdGhpcy5tZXRhZGF0YVNldC5nZXQoZmlsZSk7XG4gICAgICAgIGlmIChtZXRhZGF0YSkge1xuICAgICAgICAgICAgaWYgKGJsb2NrSUQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBtZXRhZGF0YVtcIm1hdGhMaW5rXCJdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGV0IGJsb2NrcyA9IG1ldGFkYXRhW1wibWF0aExpbmstYmxvY2tzXCJdO1xuICAgICAgICAgICAgaWYgKGJsb2Nrcykge1xuICAgICAgICAgICAgICAgIHJldHVybiBibG9ja3NbYmxvY2tJRF07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICB1cGRhdGUoZmlsZTogVEZpbGUsIG5ld01ldGFkYXRhOiBNYXRoTGlua3NNZXRhZGF0YSk6IHZvaWQge1xuICAgICAgICBpZiAoZmlsZS5leHRlbnNpb24gPT0gXCJtZFwiKSB7XG4gICAgICAgICAgICB0aGlzLm1ldGFkYXRhU2V0LnNldChmaWxlLCBPYmplY3QuYXNzaWduKHt9LCB0aGlzLm1ldGFkYXRhU2V0LmdldChmaWxlKSwgbmV3TWV0YWRhdGEpKTtcbiAgICAgICAgICAgIGluZm9ybUNoYW5nZSh0aGlzLnBsdWdpbi5hcHAsIFwibWF0aGxpbmtzOnVwZGF0ZWRcIiwgdGhpcywgZmlsZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcihgTWF0aExpbmtzIEFQSTogJHt0aGlzLm1hbmlmZXN0Lm5hbWV9IHBhc3NlZCBhIG5vbi1tYXJrZG93biBmaWxlICR7ZmlsZS5wYXRofSB0byB1cGRhdGUoKS5gKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGRlbGV0ZShmaWxlOiBURmlsZSwgd2hpY2g/OiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgLy8gYHdoaWNoID09PSB1bmRlZmluZWRgOiByZW1vdmUgYWxsIHRoZSBtYXRoTGlua3MgYXNzb2NpYXRlZCB3aXRoIGBwYXRoYFxuICAgICAgICAvLyBgd2hpY2ggPT0gXCJtYXRoTGlua1wiOiByZW1vdmUgYG1hdGhMaW5rYFxuICAgICAgICAvLyBgd2hpY2ggPT0gXCJtYXRoTGluay1ibG9ja3NcIjogcmVtb3ZlIGBtYXRoTGluay1ibG9ja3NgXG4gICAgICAgIC8vIGB3aGljaCA9PSA8YmxvY2tJRD5gOiByZW1vdmUgYG1hdGhMaW5rLWJsb2Nrc1s8YmxvY2tJRD5dYFxuICAgICAgICBsZXQgbWV0YWRhdGEgPSB0aGlzLm1ldGFkYXRhU2V0LmdldChmaWxlKTtcbiAgICAgICAgaWYgKG1ldGFkYXRhKSB7XG4gICAgICAgICAgICBpZiAod2hpY2ggPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHRoaXMubWV0YWRhdGFTZXQuZGVsZXRlKGZpbGUpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh3aGljaCA9PSBcIm1hdGhMaW5rXCIgfHwgd2hpY2ggPT0gXCJtYXRoTGluay1ibG9ja3NcIikge1xuICAgICAgICAgICAgICAgIGlmIChtZXRhZGF0YVt3aGljaF0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgbWV0YWRhdGFbd2hpY2hdO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IEVycm9yKGBNYXRoTGlua3MgQVBJOiAke3RoaXMubWFuaWZlc3QubmFtZX0gYXR0ZW1wdGVkIHRvIGRlbGV0ZSAke3doaWNofSBvZiAke2ZpbGUucGF0aH0sIGJ1dCBpdCBkb2VzIG5vdCBleGlzdC5gKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGxldCBibG9ja3MgPSBtZXRhZGF0YVtcIm1hdGhMaW5rLWJsb2Nrc1wiXTtcbiAgICAgICAgICAgICAgICBpZiAoYmxvY2tzICYmIGJsb2Nrc1t3aGljaF0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBkZWxldGUgYmxvY2tzW3doaWNoXTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcihgTWF0aExpbmtzIEFQSTogJHt0aGlzLm1hbmlmZXN0Lm5hbWV9IGF0dGVtcHRlZCB0byBkZWxldGUgbWF0aExpbmstYmxvY2tzIGZvciAke2ZpbGUucGF0aH0jXiR7d2hpY2h9XCIsIGJ1dCBpdCBkb2VzIG5vdCBleGlzdGApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRocm93IEVycm9yKGBNYXRoTGlua3MgQVBJOiAke3RoaXMubWFuaWZlc3QubmFtZX0gYXR0ZW1wdGVkIHRvIGRlbGV0ZSB0aGUgTWF0aExpbmtzIG1ldGFkYXRhIG9mICR7ZmlsZS5wYXRofSwgYnV0IGl0IGRvZXMgbm90IGV4aXN0LmApO1xuICAgICAgICB9XG4gICAgICAgIGluZm9ybUNoYW5nZSh0aGlzLnBsdWdpbi5hcHAsIFwibWF0aGxpbmtzOnVwZGF0ZWRcIiwgdGhpcywgZmlsZSk7XG4gICAgfVxufVxuXG4vLyBldmVudE5hbWU6IFwibWF0aGxpbmtzOnVwZGF0ZWRcIiB8IFwibWF0aGxpbmtzOmFjY291bnQtZGVsZXRlZFwiXG5leHBvcnQgZnVuY3Rpb24gaW5mb3JtQ2hhbmdlKGFwcDogQXBwLCBldmVudE5hbWU6IHN0cmluZywgLi4uY2FsbGJhY2tBcmdzOiBbYXBpQWNjb3VudDogTWF0aExpbmtzQVBJQWNjb3VudCwgZmlsZT86IFRGaWxlXSkge1xuICAgIC8vIHRyaWdnZXIgYW4gZXZlbnQgaW5mb3JtaW5nIHRoaXMgdXBkYXRlXG4gICAgYXBwLm1ldGFkYXRhQ2FjaGUudHJpZ2dlcihldmVudE5hbWUsIC4uLmNhbGxiYWNrQXJncyk7XG5cbiAgICAvLyByZWZyZXNoIG1hdGhMaW5rcyBkaXNwbGF5IGJhc2VkIG9uIHRoZSBuZXcgbWV0YWRhdGFcbiAgICBhcHAud29ya3NwYWNlLml0ZXJhdGVSb290TGVhdmVzKChsZWFmOiBXb3Jrc3BhY2VMZWFmKSA9PiB7XG4gICAgICAgIGlmIChsZWFmLnZpZXcgaW5zdGFuY2VvZiBNYXJrZG93blZpZXcgJiYgbGVhZi52aWV3LmdldE1vZGUoKSA9PSAnc291cmNlJykge1xuICAgICAgICAgICAgbGVhZi52aWV3LmVkaXRvci5jbT8uZGlzcGF0Y2goKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuIiwgImltcG9ydCB7IFRGaWxlLCBnZXRMaW5rcGF0aCwgTWFya2Rvd25SZW5kZXJDaGlsZCwgTWFya2Rvd25Qb3N0UHJvY2Vzc29yQ29udGV4dCB9IGZyb20gXCJvYnNpZGlhblwiO1xuaW1wb3J0IHsgc2V0TWF0aExpbmssIGdldE1hdGhMaW5rIH0gZnJvbSBcIi4vaGVscGVyXCJcbmltcG9ydCB7IHRyYW5zbGF0ZUxpbmsgfSBmcm9tIFwiLi4vdXRpbHNcIjtcbmltcG9ydCBNYXRoTGlua3MgZnJvbSBcIi4uL21haW5cIlxuXG5leHBvcnQgY2xhc3MgTWF0aExpbmtzUmVuZGVyQ2hpbGQgZXh0ZW5kcyBNYXJrZG93blJlbmRlckNoaWxkIHtcbiAgICByZWFkb25seSB0YXJnZXRGaWxlOiBURmlsZSB8IG51bGw7XG4gICAgcmVhZG9ubHkgZ2V0TWF0aExpbms6ICgpID0+IHN0cmluZztcbiAgICBtYXRoTGlua0VsOiBIVE1MRWxlbWVudDtcblxuICAgIGNvbnN0cnVjdG9yKGNvbnRhaW5lckVsOiBIVE1MRWxlbWVudCwgcHVibGljIHBsdWdpbjogTWF0aExpbmtzLCBwdWJsaWMgc291cmNlUGF0aDogc3RyaW5nLCBwdWJsaWMgdGFyZ2V0TGluazogc3RyaW5nLCBwdWJsaWMgZGlzcGxheVRleHQ6IHN0cmluZykge1xuICAgICAgICBzdXBlcihjb250YWluZXJFbCk7XG4gICAgICAgIHRoaXMudGFyZ2V0RmlsZSA9IHRoaXMucGx1Z2luLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpcnN0TGlua3BhdGhEZXN0KGdldExpbmtwYXRoKHRoaXMudGFyZ2V0TGluayksIHRoaXMuc291cmNlUGF0aCk7XG4gICAgICAgIHRoaXMubWF0aExpbmtFbCA9IHRoaXMuY29udGFpbmVyRWwuY2xvbmVOb2RlKHRydWUpIGFzIEhUTUxFbGVtZW50O1xuICAgICAgICB0aGlzLm1hdGhMaW5rRWwudGV4dENvbnRlbnQgPSBcIlwiO1xuICAgICAgICB0aGlzLmNvbnRhaW5lckVsLnBhcmVudE5vZGU/Lmluc2VydEJlZm9yZSh0aGlzLm1hdGhMaW5rRWwsIHRoaXMuY29udGFpbmVyRWwubmV4dFNpYmxpbmcpO1xuICAgICAgICB0aGlzLm1hdGhMaW5rRWwuY2xhc3NMaXN0LmFkZChcIm1hdGhMaW5rLWludGVybmFsLWxpbmtcIik7XG4gICAgICAgIHRoaXMuY29udGFpbmVyRWwuY2xhc3NMaXN0LmFkZChcIm9yaWdpbmFsLWludGVybmFsLWxpbmtcIik7XG4gICAgICAgIHRoaXMuY29udGFpbmVyRWwuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICB0aGlzLmdldE1hdGhMaW5rID0gdGhpcy5zZXRNYXRoTGlua0dldHRlcigpO1xuICAgIH1cblxuICAgIG9ubG9hZCgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy51cGRhdGUoKTtcblxuICAgICAgICAvLyAxLiB3aGVuIHVzZXIgdXBkYXRlcyB0aGUgWUFNTCBmcm9udG1hdHRlclxuICAgICAgICB0aGlzLnBsdWdpbi5yZWdpc3RlckV2ZW50KHRoaXMucGx1Z2luLmFwcC5tZXRhZGF0YUNhY2hlLm9uKFwiY2hhbmdlZFwiLCAoY2hhbmdlZEZpbGUpID0+IHtcbiAgICAgICAgICAgIGlmICghdGhpcy50YXJnZXRGaWxlIHx8IHRoaXMudGFyZ2V0RmlsZSA9PSBjaGFuZ2VkRmlsZSkge1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKTtcblxuICAgICAgICAvLyAyLiB3aGVuIGFuIEFQSSB1c2VyIHVwZGF0ZXMgaXRzIG1ldGFkYXRhXG4gICAgICAgIHRoaXMucGx1Z2luLnJlZ2lzdGVyRXZlbnQodGhpcy5wbHVnaW4uYXBwLm1ldGFkYXRhQ2FjaGUub24oXCJtYXRobGlua3M6dXBkYXRlZFwiLCAoYXBpQWNjb3VudCwgY2hhbmdlZEZpbGUpID0+IHtcbiAgICAgICAgICAgIGlmICghdGhpcy50YXJnZXRGaWxlIHx8IHRoaXMudGFyZ2V0RmlsZSA9PSBjaGFuZ2VkRmlsZSkge1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKTtcblxuICAgICAgICAvLyAzLiB3aGVuIGFuIEFQSSBhY2NvdW50IGlzIGRlbGV0ZWRcbiAgICAgICAgdGhpcy5wbHVnaW4ucmVnaXN0ZXJFdmVudCh0aGlzLnBsdWdpbi5hcHAubWV0YWRhdGFDYWNoZS5vbihcIm1hdGhsaW5rczphY2NvdW50LWRlbGV0ZWRcIiwgKGFwaUFjY291bnQpID0+IHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlKCk7XG4gICAgICAgIH0pKTtcbiAgICB9XG5cbiAgICBzZXRNYXRoTGlua0dldHRlcigpOiAoKSA9PiBzdHJpbmcge1xuICAgICAgICBsZXQgZ2V0dGVyID0gKCkgPT4gXCJcIjtcbiAgICAgICAgaWYgKHRoaXMuZGlzcGxheVRleHQgIT0gdGhpcy50YXJnZXRMaW5rICYmIHRoaXMuZGlzcGxheVRleHQgIT0gdHJhbnNsYXRlTGluayh0aGlzLnRhcmdldExpbmspKSB7XG4gICAgICAgICAgICAvLyBbW25vdGV8ZGlzcGxheV1dIC0+IHVzZSBkaXNwbGF5IGFzIG1hdGhMaW5rXG4gICAgICAgICAgICBnZXR0ZXIgPSAoKSA9PiB0aGlzLmRpc3BsYXlUZXh0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHRoaXMuZGlzcGxheVRleHQgPT0gdGhpcy50YXJnZXRGaWxlPy5uYW1lIHx8IHRoaXMuZGlzcGxheVRleHQgPT0gdGhpcy50YXJnZXRGaWxlPy5iYXNlbmFtZSB8fCB0aGlzLmRpc3BsYXlUZXh0ID09IHRyYW5zbGF0ZUxpbmsodGhpcy50YXJnZXRMaW5rKSkge1xuICAgICAgICAgICAgICAgIC8vIFtbbm90ZV1dLCBbW25vdGUjaGVhZGluZ11dIG9yIFtbbm90ZSNeYmxvY2tJRF1dXG4gICAgICAgICAgICAgICAgZ2V0dGVyID0gKCkgPT4gZ2V0TWF0aExpbmsodGhpcy5wbHVnaW4sIHRoaXMudGFyZ2V0TGluaywgdGhpcy5zb3VyY2VQYXRoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZ2V0dGVyO1xuICAgIH1cblxuICAgIGFzeW5jIHVwZGF0ZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgY29uc3QgbWF0aExpbmsgPSB0aGlzLmdldE1hdGhMaW5rKCk7XG5cbiAgICAgICAgaWYgKG1hdGhMaW5rKSB7XG4gICAgICAgICAgICBzZXRNYXRoTGluayhtYXRoTGluaywgdGhpcy5tYXRoTGlua0VsKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHNldE1hdGhMaW5rKHRoaXMuZGlzcGxheVRleHQsIHRoaXMubWF0aExpbmtFbCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZU1hdGhMaW5rcyhwbHVnaW46IE1hdGhMaW5rcywgZWxlbWVudDogSFRNTEVsZW1lbnQsIGNvbnRleHQ6IE1hcmtkb3duUG9zdFByb2Nlc3NvckNvbnRleHQpOiB2b2lkIHtcbiAgICBmb3IgKGxldCB0YXJnZXRFbCBvZiBlbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGw8SFRNTEVsZW1lbnQ+KFwiLmludGVybmFsLWxpbmtcIikpIHtcbiAgICAgICAgaWYgKHRhcmdldEVsLmNsYXNzTGlzdC5jb250YWlucyhcIm1hdGhMaW5rLWludGVybmFsLWxpbmtcIikpIHtcbiAgICAgICAgICAgIHRhcmdldEVsLnJlbW92ZSgpO1xuICAgICAgICAgICAgbGV0IHF1ZXJ5UmVzdWx0ID0gZWxlbWVudC5xdWVyeVNlbGVjdG9yPEhUTUxFbGVtZW50PihcIi5vcmlnaW5hbC1pbnRlcm5hbC1saW5rXCIpO1xuICAgICAgICAgICAgaWYgKHF1ZXJ5UmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0RWwgPSBxdWVyeVJlc3VsdDtcbiAgICAgICAgICAgICAgICB0YXJnZXRFbC5jbGFzc0xpc3QucmVtb3ZlKFwib3JpZ2luYWwtaW50ZXJuYWwtbGlua1wiKTtcbiAgICAgICAgICAgICAgICB0YXJnZXRFbC5zdHlsZS5kaXNwbGF5ID0gXCJcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHRhcmdldERpc3BsYXkgPSB0YXJnZXRFbC50ZXh0Q29udGVudD8udHJpbSgpLnJlcGxhY2UoL1xcLm1kLywgXCJcIik7XG4gICAgICAgIGlmICh0YXJnZXREaXNwbGF5ICE9IFwiXCIgJiYgIS9tYXRoLWlubGluZSBpcy1sb2FkZWQvLnRlc3QodGFyZ2V0RWwuaW5uZXJIVE1MKSkge1xuICAgICAgICAgICAgY29uc3QgdGFyZ2V0TGluayA9IHRhcmdldEVsLmdldEF0dHJpYnV0ZShcImRhdGEtaHJlZlwiKT8ucmVwbGFjZSgvXFwubWQvLCBcIlwiKTtcbiAgICAgICAgICAgIGlmICh0YXJnZXRMaW5rKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0RmlsZSA9IHBsdWdpbi5hcHAubWV0YWRhdGFDYWNoZS5nZXRGaXJzdExpbmtwYXRoRGVzdChnZXRMaW5rcGF0aCh0YXJnZXRMaW5rKSwgY29udGV4dC5zb3VyY2VQYXRoKTtcbiAgICAgICAgICAgICAgICBpZiAodGFyZ2V0RGlzcGxheSAmJiB0YXJnZXRGaWxlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNoaWxkID0gbmV3IE1hdGhMaW5rc1JlbmRlckNoaWxkKHRhcmdldEVsLCBwbHVnaW4sIGNvbnRleHQuc291cmNlUGF0aCwgdGFyZ2V0TGluaywgdGFyZ2V0RGlzcGxheSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnRleHQuYWRkQ2hpbGQoY2hpbGQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cbiIsICJpbXBvcnQgeyBURmlsZSwgcmVuZGVyTWF0aCwgZmluaXNoUmVuZGVyTWF0aCwgcGFyc2VMaW5rdGV4dCwgcmVzb2x2ZVN1YnBhdGgsIEJsb2NrU3VicGF0aFJlc3VsdCwgSGVhZGluZ1N1YnBhdGhSZXN1bHQgfSBmcm9tIFwib2JzaWRpYW5cIjtcbmltcG9ydCB7IE1hdGhMaW5rc01ldGFkYXRhIH0gZnJvbSBcIi4uL2FwaS9hcGlcIjtcbmltcG9ydCBNYXRoTGlua3MgZnJvbSBcIi4uL21haW5cIjtcblxuZXhwb3J0IGZ1bmN0aW9uIHNldE1hdGhMaW5rKHNvdXJjZTogc3RyaW5nLCBtYXRoTGlua0VsOiBIVE1MRWxlbWVudCkge1xuICAgIG1hdGhMaW5rRWwucmVwbGFjZUNoaWxkcmVuKCk7XG4gICAgY29uc3QgbWF0aFBhdHRlcm4gPSAvXFwkKC4qP1teXFxzXSlcXCQvZztcbiAgICBsZXQgdGV4dEZyb20gPSAwLCB0ZXh0VG8gPSAwO1xuICAgIGxldCByZXN1bHQ7XG4gICAgd2hpbGUgKChyZXN1bHQgPSBtYXRoUGF0dGVybi5leGVjKHNvdXJjZSkpICE9PSBudWxsKSB7XG4gICAgICAgIGNvbnN0IG1hdGhTdHJpbmcgPSByZXN1bHRbMV07XG4gICAgICAgIHRleHRUbyA9IHJlc3VsdC5pbmRleDtcbiAgICAgICAgaWYgKHRleHRUbyA+IHRleHRGcm9tKSBtYXRoTGlua0VsLmNyZWF0ZVNwYW4oKS5yZXBsYWNlV2l0aChzb3VyY2Uuc2xpY2UodGV4dEZyb20sIHRleHRUbykpO1xuXG4gICAgICAgIGNvbnN0IG1hdGhFbCA9IHJlbmRlck1hdGgobWF0aFN0cmluZywgZmFsc2UpO1xuICAgICAgICBtYXRoTGlua0VsLmNyZWF0ZVNwYW4oeyBjbHM6IFtcIm1hdGhcIiwgXCJtYXRoLWlubGluZVwiLCBcImlzLWxvYWRlZFwiXSB9KS5yZXBsYWNlV2l0aChtYXRoRWwpO1xuICAgICAgICBmaW5pc2hSZW5kZXJNYXRoKCk7XG5cbiAgICAgICAgdGV4dEZyb20gPSBtYXRoUGF0dGVybi5sYXN0SW5kZXg7XG4gICAgfVxuXG4gICAgaWYgKHRleHRGcm9tIDwgc291cmNlLmxlbmd0aCkgbWF0aExpbmtFbC5jcmVhdGVTcGFuKCkucmVwbGFjZVdpdGgoc291cmNlLnNsaWNlKHRleHRGcm9tKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRNYXRoTGluayhwbHVnaW46IE1hdGhMaW5rcywgdGFyZ2V0TGluazogc3RyaW5nLCBzb3VyY2VQYXRoOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGxldCB7IHBhdGgsIHN1YnBhdGggfSA9IHBhcnNlTGlua3RleHQodGFyZ2V0TGluayk7XG5cbiAgICBsZXQgZmlsZSA9IHBsdWdpbi5hcHAubWV0YWRhdGFDYWNoZS5nZXRGaXJzdExpbmtwYXRoRGVzdChwYXRoLCBzb3VyY2VQYXRoKTtcbiAgICBpZiAoIWZpbGUpIHJldHVybiBcIlwiO1xuXG4gICAgbGV0IGNhY2hlID0gcGx1Z2luLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZShmaWxlKTtcbiAgICBpZiAoIWNhY2hlKSByZXR1cm4gXCJcIjtcblxuICAgIGxldCBzdWJwYXRoUmVzdWx0ID0gcmVzb2x2ZVN1YnBhdGgoY2FjaGUsIHN1YnBhdGgpO1xuXG4gICAgbGV0IG1hdGhMaW5rID0gXCJcIjtcbiAgICBpZiAoc3VicGF0aFJlc3VsdCkge1xuICAgICAgICBtYXRoTGluayA9IGdldE1hdGhMaW5rRnJvbVN1YnBhdGgocGF0aCwgc3VicGF0aFJlc3VsdCwgY2FjaGUuZnJvbnRtYXR0ZXIsIHBsdWdpbi5zZXR0aW5ncy5ibG9ja1ByZWZpeCxcbiAgICAgICAgICAgIC8vIElmIGVuYWJsZUZpbGVOYW1lQmxvY2tMaW5rcyA9PSB0cnVlLCBwYXNzIGBudWxsYCB0byB0aGUgbGFzdCBwYXJhbWV0ZXIgYHByZWZpeGAsIHdoaWNoIG1lYW5zIHVzaW5nIHRoZSBzdGFuZGFyZCBwcmVmaXggKGUuZy4gbm90ZSA+IGJsb2NrKS4gXG4gICAgICAgICAgICAvLyBPdGhlcndpc2UsIHBhc3MgYW4gZW1wdHkgc3RyaW5nIHRvIGBwcmVmaXhgLCB3aGljaCBtZWFucyB1c2luZyBubyBwcmVmaXggKG5vIHByZWZpeCBpcyBhIHNwZWNpYWwgY2FzZSBvZiBjdXN0b20gcHJlZml4ZXMpLlxuICAgICAgICAgICAgcGx1Z2luLnNldHRpbmdzLmVuYWJsZUZpbGVOYW1lQmxvY2tMaW5rcyA/IG51bGwgOiBcIlwiXG4gICAgICAgICk7XG4gICAgfSBlbHNlIGlmIChwYXRoKSB7XG4gICAgICAgIG1hdGhMaW5rID0gY2FjaGUuZnJvbnRtYXR0ZXI/Lm1hdGhMaW5rO1xuICAgICAgICBpZiAobWF0aExpbmsgPT0gXCJhdXRvXCIpIHtcbiAgICAgICAgICAgIG1hdGhMaW5rID0gZ2V0TWF0aExpbmtGcm9tVGVtcGxhdGVzKHBsdWdpbiwgZmlsZSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoIW1hdGhMaW5rICYmIHBsdWdpbi5zZXR0aW5ncy5lbmFibGVBUEkpIHtcbiAgICAgICAgY29uc3Qgc291cmNlRmlsZSA9IHBsdWdpbi5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKHNvdXJjZVBhdGgpO1xuICAgICAgICBpZiAoc291cmNlRmlsZSBpbnN0YW5jZW9mIFRGaWxlKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBhY2NvdW50IG9mIHBsdWdpbi5hcGlBY2NvdW50cykge1xuICAgICAgICAgICAgICAgIGNvbnN0IG1ldGFkYXRhID0gYWNjb3VudC5tZXRhZGF0YVNldC5nZXQoZmlsZSk7XG4gICAgICAgICAgICAgICAgaWYgKG1ldGFkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzdWJwYXRoUmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtYXRoTGluayA9IGdldE1hdGhMaW5rRnJvbVN1YnBhdGgocGF0aCwgc3VicGF0aFJlc3VsdCwgbWV0YWRhdGEsIGFjY291bnQuYmxvY2tQcmVmaXgsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQW4gQVBJIHVzZXIgY2FuIHNwZWNpZnkgY3VzdG9tIHByZWZpeGVzIGRlcGVuZGluZyBvbiB0aGUgc291cmNlIGZpbGUgKHNvdXJjZUZpbGUpICYgdGhlIHRhcmdldCBmaWxlIChmaWxlKS5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50LnByZWZpeGVyKHNvdXJjZUZpbGUsIGZpbGUsIHN1YnBhdGhSZXN1bHQpXG4gICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgbWF0aExpbmsgPSBtZXRhZGF0YVtcIm1hdGhMaW5rXCJdID8/IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG1hdGhMaW5rKSB7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBtYXRoTGluaztcbn1cblxuZnVuY3Rpb24gZ2V0TWF0aExpbmtGcm9tU3VicGF0aChsaW5rcGF0aDogc3RyaW5nLCBzdWJwYXRoUmVzdWx0OiBIZWFkaW5nU3VicGF0aFJlc3VsdCB8IEJsb2NrU3VicGF0aFJlc3VsdCwgbWV0YWRhdGE6IE1hdGhMaW5rc01ldGFkYXRhIHwgdW5kZWZpbmVkLCBibG9ja1ByZWZpeDogc3RyaW5nLCBwcmVmaXg6IHN0cmluZyB8IG51bGwpOiBzdHJpbmcge1xuICAgIGxldCBzdWJNYXRoTGluayA9IFwiXCJcbiAgICBpZiAoc3VicGF0aFJlc3VsdC50eXBlID09IFwiaGVhZGluZ1wiKSB7XG4gICAgICAgIHN1Yk1hdGhMaW5rID0gc3VicGF0aFJlc3VsdC5jdXJyZW50LmhlYWRpbmc7XG4gICAgfSBlbHNlIGlmIChzdWJwYXRoUmVzdWx0LnR5cGUgPT0gXCJibG9ja1wiICYmIG1ldGFkYXRhPy5bXCJtYXRoTGluay1ibG9ja3NcIl0/LltzdWJwYXRoUmVzdWx0LmJsb2NrLmlkXSkge1xuICAgICAgICBzdWJNYXRoTGluayA9IGJsb2NrUHJlZml4ICsgbWV0YWRhdGFbXCJtYXRoTGluay1ibG9ja3NcIl1bc3VicGF0aFJlc3VsdC5ibG9jay5pZF07XG4gICAgfVxuICAgIGlmIChzdWJNYXRoTGluaykge1xuICAgICAgICBpZiAocHJlZml4ID09PSBudWxsKSB7IC8vIHVzZSBzdGFuZGFyZCBwcmVmaXhcbiAgICAgICAgICAgIGlmIChsaW5rcGF0aCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAobWV0YWRhdGE/LltcIm1hdGhMaW5rXCJdID8/IGxpbmtwYXRoKSArIFwiID4gXCIgKyBzdWJNYXRoTGluaztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHN1Yk1hdGhMaW5rO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgeyAvLyB0eXBlb2YgcHJlZml4ID09ICdzdHJpbmcnID0+IHVzZSBjdXN0b20gcHJlZml4IFxuICAgICAgICAgICAgcmV0dXJuIHByZWZpeCArIHN1Yk1hdGhMaW5rO1xuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBnZXRNYXRoTGlua0Zyb21UZW1wbGF0ZXMocGx1Z2luOiBNYXRoTGlua3MsIGZpbGU6IFRGaWxlKTogc3RyaW5nIHtcbiAgICBsZXQgdGVtcGxhdGVzID0gcGx1Z2luLnNldHRpbmdzLnRlbXBsYXRlcztcbiAgICBsZXQgbWF0aExpbmsgPSBmaWxlLm5hbWUucmVwbGFjZSgvXFwubWQkLywgXCJcIik7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0ZW1wbGF0ZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgbGV0IHJlcGxhY2VkID0gbmV3IFJlZ0V4cCh0ZW1wbGF0ZXNbaV0ucmVwbGFjZWQpO1xuICAgICAgICBsZXQgcmVwbGFjZW1lbnQgPSB0ZW1wbGF0ZXNbaV0ucmVwbGFjZW1lbnQ7XG5cbiAgICAgICAgbGV0IGZsYWdzID0gXCJcIjtcbiAgICAgICAgaWYgKHRlbXBsYXRlc1tpXS5nbG9iYWxNYXRjaCkgZmxhZ3MgKz0gXCJnXCI7XG4gICAgICAgIGlmICghdGVtcGxhdGVzW2ldLnNlbnNpdGl2ZSkgZmxhZ3MgKz0gXCJpXCI7XG5cbiAgICAgICAgaWYgKHRlbXBsYXRlc1tpXS53b3JkKVxuICAgICAgICAgICAgcmVwbGFjZWQgPSBSZWdFeHAocmVwbGFjZWQuc291cmNlLnJlcGxhY2UoL14vLCBcIlxcXFxiXCIpLnJlcGxhY2UoLyQvLCBcIlxcXFxiXCIpLCBmbGFncyk7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHJlcGxhY2VkID0gUmVnRXhwKHJlcGxhY2VkLnNvdXJjZSwgZmxhZ3MpO1xuXG4gICAgICAgIG1hdGhMaW5rID0gbWF0aExpbmsucmVwbGFjZShyZXBsYWNlZCwgcmVwbGFjZW1lbnQpO1xuICAgIH1cblxuICAgIHJldHVybiBtYXRoTGluaztcbn1cbiIsICJpbXBvcnQgeyBzeW50YXhUcmVlIH0gZnJvbSBcIkBjb2RlbWlycm9yL2xhbmd1YWdlXCI7XG5pbXBvcnQgeyBSYW5nZVNldEJ1aWxkZXIgfSBmcm9tIFwiQGNvZGVtaXJyb3Ivc3RhdGVcIjtcbmltcG9ydCB7IERlY29yYXRpb24sIERlY29yYXRpb25TZXQsIFZpZXdVcGRhdGUsIEVkaXRvclZpZXcsIFZpZXdQbHVnaW4sIFdpZGdldFR5cGUsIFBsdWdpblZhbHVlIH0gZnJvbSBcIkBjb2RlbWlycm9yL3ZpZXdcIjtcbmltcG9ydCB7IEZpbGVWaWV3LCBNYXJrZG93blZpZXcsIFdvcmtzcGFjZUxlYWYsIFRGaWxlLCBnZXRMaW5rcGF0aCwgS2V5bWFwIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBnZXRNYXRoTGluaywgc2V0TWF0aExpbmsgfSBmcm9tIFwiLi9oZWxwZXJcIjtcbmltcG9ydCB7IGFkZFN1cGVyQ2hhcmdlZCB9IGZyb20gXCIuL3N1cGVyY2hhcmdlZFwiO1xuaW1wb3J0IHsgaXNFeGNsdWRlZCB9IGZyb20gXCIuLi91dGlsc1wiO1xuaW1wb3J0IE1hdGhMaW5rcyBmcm9tIFwiLi4vbWFpblwiO1xuXG5leHBvcnQgZnVuY3Rpb24gYnVpbGRMaXZlUHJldmlldzxWIGV4dGVuZHMgUGx1Z2luVmFsdWU+KHBsdWdpbjogTWF0aExpbmtzLCBsZWFmOiBXb3Jrc3BhY2VMZWFmKTogUHJvbWlzZTxWaWV3UGx1Z2luPFY+PiB7XG4gICAgbGV0IGxlYWZWaWV3ID0gbGVhZi52aWV3IGFzIEZpbGVWaWV3O1xuXG4gICAgY2xhc3MgTWF0aFdpZGdldCBleHRlbmRzIFdpZGdldFR5cGUge1xuICAgICAgICBjb25zdHJ1Y3RvcihwdWJsaWMgb3V0TGlua1RleHQ6IHN0cmluZywgcHVibGljIG91dExpbmtNYXRoTGluazogc3RyaW5nKSB7IHN1cGVyKCk7IH1cblxuICAgICAgICB0b0RPTSgpIHtcbiAgICAgICAgICAgIGxldCBtYXRoTGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzcGFuXCIpO1xuICAgICAgICAgICAgc2V0TWF0aExpbmsodGhpcy5vdXRMaW5rTWF0aExpbmssIG1hdGhMaW5rKTtcbiAgICAgICAgICAgIG1hdGhMaW5rLmNsYXNzTGlzdC5hZGQoXCJjbS11bmRlcmxpbmVcIik7XG4gICAgICAgICAgICBtYXRoTGluay5zZXRBdHRyaWJ1dGUoXCJkcmFnZ2FibGVcIiwgXCJ0cnVlXCIpO1xuXG4gICAgICAgICAgICBsZXQgb3V0TGlua0ZpbGUgPSBwbHVnaW4uYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0Rmlyc3RMaW5rcGF0aERlc3QodGhpcy5vdXRMaW5rVGV4dC5yZXBsYWNlKC8jLiokLywgXCJcIiksIFwiXCIpO1xuICAgICAgICAgICAgaWYgKG91dExpbmtGaWxlKSBhZGRTdXBlckNoYXJnZWQocGx1Z2luLCBtYXRoTGluaywgb3V0TGlua0ZpbGUpO1xuXG4gICAgICAgICAgICBsZXQgbWF0aExpbmtXcmFwcGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG4gICAgICAgICAgICBtYXRoTGlua1dyYXBwZXIuY2xhc3NMaXN0LmFkZChcImNtLWhtZC1pbnRlcm5hbC1saW5rXCIpO1xuICAgICAgICAgICAgbWF0aExpbmtXcmFwcGVyLmFwcGVuZENoaWxkKG1hdGhMaW5rKTtcblxuICAgICAgICAgICAgbGV0IHNvdXJjZVBhdGggPSBcIlwiO1xuICAgICAgICAgICAgaWYgKGxlYWZWaWV3LmZpbGUpIHtcbiAgICAgICAgICAgICAgICBzb3VyY2VQYXRoID0gbGVhZlZpZXcuZmlsZS5wYXRoO1xuICAgICAgICAgICAgICAgIGlmIChzb3VyY2VQYXRoLmVuZHNXaXRoKFwiLmNhbnZhc1wiKSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBub2RlIG9mIGxlYWZWaWV3LmNhbnZhcy5zZWxlY3Rpb24udmFsdWVzKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZVBhdGggPSBub2RlLmZpbGVQYXRoO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IHRhcmdldEZpbGUgPSBwbHVnaW4uYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0Rmlyc3RMaW5rcGF0aERlc3QoZ2V0TGlua3BhdGgodGhpcy5vdXRMaW5rVGV4dCksIHNvdXJjZVBhdGgpO1xuXG4gICAgICAgICAgICBtYXRoTGlua1dyYXBwZXIub25jbGljayA9ICgoZXZ0OiBNb3VzZUV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgaWYgKHRhcmdldEZpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcGx1Z2luLmFwcC53b3Jrc3BhY2Uub3BlbkxpbmtUZXh0KHRoaXMub3V0TGlua1RleHQsIHNvdXJjZVBhdGgsIEtleW1hcC5pc01vZEV2ZW50KGV2dCkpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYub3Blbih0aGlzLm91dExpbmtUZXh0LCBcIl9ibGFua1wiLCBcIm5vcmVmZXJyZXJcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIG1hdGhMaW5rV3JhcHBlci5vbm1vdXNlZG93biA9ICgoZXZ0OiBNb3VzZUV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGV2dC5idXR0b24gPT0gMSkge1xuICAgICAgICAgICAgICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgbWF0aExpbmtXcmFwcGVyLm9uYXV4Y2xpY2sgPSAoKGV2dDogTW91c2VFdmVudCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChldnQuYnV0dG9uID09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldEZpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBsdWdpbi5hcHAud29ya3NwYWNlLm9wZW5MaW5rVGV4dCh0aGlzLm91dExpbmtUZXh0LCBzb3VyY2VQYXRoLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYub3Blbih0aGlzLm91dExpbmtUZXh0LCBcIl9ibGFua1wiLCBcIm5vcmVmZXJyZXJcIik7XG4gICAgICAgICAgICAgICAgICAgIH0gICAgXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBtYXRoTGlua1dyYXBwZXI7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBsZXQgdmlld1BsdWdpbiA9IFZpZXdQbHVnaW4uZnJvbUNsYXNzKFxuICAgICAgICBjbGFzcyB7XG4gICAgICAgICAgICBkZWNvcmF0aW9uczogRGVjb3JhdGlvblNldDtcblxuICAgICAgICAgICAgY29uc3RydWN0b3IodmlldzogRWRpdG9yVmlldykge1xuICAgICAgICAgICAgICAgIGxlYWZWaWV3ID0gbGVhZi52aWV3IGFzIEZpbGVWaWV3O1xuICAgICAgICAgICAgICAgIHRoaXMudHJ5QnVpbGRpbmdEZWNvcmF0aW9ucyh2aWV3KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdXBkYXRlKHVwZGF0ZTogVmlld1VwZGF0ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMudHJ5QnVpbGRpbmdEZWNvcmF0aW9ucyh1cGRhdGUudmlldyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRyeUJ1aWxkaW5nRGVjb3JhdGlvbnModmlldzogRWRpdG9yVmlldykge1xuICAgICAgICAgICAgICAgIHRoaXMuZGVjb3JhdGlvbnMgPSBEZWNvcmF0aW9uLm5vbmU7XG5cbiAgICAgICAgICAgICAgICBsZXQgZWRpdG9yVmlldyA9IGxlYWYuZ2V0Vmlld1N0YXRlKCk7XG5cbiAgICAgICAgICAgICAgICBpZiAobGVhZi52aWV3IGluc3RhbmNlb2YgTWFya2Rvd25WaWV3ICYmIGxlYWYudmlldy5maWxlIGluc3RhbmNlb2YgVEZpbGUgJiYgaXNFeGNsdWRlZChwbHVnaW4sIGxlYWYudmlldy5maWxlKSkge1xuICAgICAgICAgICAgICAgICAgICBsZXQgY3VyVmlldyA9IGxlYWYudmlldy5lZGl0b3IuY207XG4gICAgICAgICAgICAgICAgICAgIGlmIChjdXJWaWV3ID09IHZpZXcgJiYgZWRpdG9yVmlldy5zdGF0ZS5tb2RlID09IFwic291cmNlXCIgJiYgIWVkaXRvclZpZXcuc3RhdGUuc291cmNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmRlY29yYXRpb25zID0gdGhpcy5idWlsZERlY29yYXRpb25zKHZpZXcpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kZWNvcmF0aW9ucyA9IERlY29yYXRpb24ubm9uZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobGVhZlZpZXcuY2FudmFzKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IG5vZGUgb2YgbGVhZlZpZXcuY2FudmFzLnNlbGVjdGlvbi52YWx1ZXMoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzRXhjbHVkZWQocGx1Z2luLCBub2RlLmZpbGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kZWNvcmF0aW9ucyA9IHRoaXMuYnVpbGREZWNvcmF0aW9ucyh2aWV3KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHBsdWdpbi5hcHAud29ya3NwYWNlLml0ZXJhdGVSb290TGVhdmVzKChvdGhlckxlYWY6IFdvcmtzcGFjZUxlYWYpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvdGhlckxlYWYudmlldyBpbnN0YW5jZW9mIE1hcmtkb3duVmlldykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBvdGhlclZpZXcgPSBvdGhlckxlYWYudmlldy5lZGl0b3IuY207XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG90aGVyVmlldyA9PSB2aWV3KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGVjb3JhdGlvbnMgPSBEZWNvcmF0aW9uLm5vbmU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGJ1aWxkRGVjb3JhdGlvbnModmlldzogRWRpdG9yVmlldykge1xuICAgICAgICAgICAgICAgIGxldCBidWlsZGVyID0gbmV3IFJhbmdlU2V0QnVpbGRlcjxEZWNvcmF0aW9uPigpO1xuXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgeyBmcm9tLCB0byB9IG9mIHZpZXcudmlzaWJsZVJhbmdlcykge1xuICAgICAgICAgICAgICAgICAgICBsZXQgc3RhcnQgPSAtMSwgZW5kID0gLTEsIG91dExpbmtUZXh0ID0gXCJcIiwgb3V0TGlua01hdGhMaW5rID0gXCJcIjtcblxuICAgICAgICAgICAgICAgICAgICBzeW50YXhUcmVlKHZpZXcuc3RhdGUpLml0ZXJhdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgZnJvbSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvLFxuICAgICAgICAgICAgICAgICAgICAgICAgZW50ZXIobm9kZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBuYW1lID0gbm9kZS50eXBlLm5hbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3RhcnRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobmFtZS5jb250YWlucyhcImZvcm1hdHRpbmctbGlua19mb3JtYXR0aW5nLWxpbmstc3RhcnRcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQgPSBub2RlLmZyb207XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3RhcnQgKGNoZWNrIHRoYXQgaXQgaXMgbm90IGVuZClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChuYW1lLmNvbnRhaW5zKFwiZm9ybWF0dGluZ19mb3JtYXR0aW5nLWxpbmtfbGlua1wiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhcnQgPT0gLTEpIHN0YXJ0ID0gbm9kZS5mcm9tO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFsaWFzOiBGaWxlIG5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChuYW1lLmNvbnRhaW5zKFwiaGFzLWFsaWFzXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dExpbmtUZXh0ICs9IHZpZXcuc3RhdGUuZG9jLnNsaWNlU3RyaW5nKG5vZGUuZnJvbSwgbm9kZS50byk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsZWFmVmlldy5maWxlICYmIG91dExpbmtNYXRoTGluayA9PSBvdXRMaW5rVGV4dC5yZXBsYWNlKC9cXC5tZC8sIFwiXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRMaW5rTWF0aExpbmsgPSBnZXRNYXRoTGluayhwbHVnaW4sIG91dExpbmtUZXh0LCBsZWFmVmlldy5maWxlLnBhdGgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWxpYXM6IEZpbGUgbmFtZSAod2l0aCBkZWNvZGluZylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICgvc3RyaW5nX3VybCQvLnRlc3QobmFtZSkgJiYgIW5hbWUuY29udGFpbnMoXCJmb3JtYXRcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0TGlua1RleHQgKz0gZGVjb2RlVVJJKHZpZXcuc3RhdGUuZG9jLnNsaWNlU3RyaW5nKG5vZGUuZnJvbSwgbm9kZS50bykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobGVhZlZpZXcuZmlsZSAmJiBvdXRMaW5rTWF0aExpbmsgPT0gb3V0TGlua1RleHQucmVwbGFjZSgvXFwubWQvLCBcIlwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0TGlua01hdGhMaW5rID0gZ2V0TWF0aExpbmsocGx1Z2luLCBvdXRMaW5rVGV4dCwgbGVhZlZpZXcuZmlsZS5wYXRoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5vIGFsaWFzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAobGVhZlZpZXcuZmlsZSAmJiBuYW1lLmNvbnRhaW5zKFwiaG1kLWludGVybmFsLWxpbmtcIikgJiYgIW5hbWUuY29udGFpbnMoXCJhbGlhc1wiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRMaW5rVGV4dCArPSB2aWV3LnN0YXRlLmRvYy5zbGljZVN0cmluZyhub2RlLmZyb20sIG5vZGUudG8pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRMaW5rTWF0aExpbmsgPSBnZXRNYXRoTGluayhwbHVnaW4sIG91dExpbmtUZXh0LCBsZWFmVmlldy5maWxlLnBhdGgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEVuZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKG5hbWUuY29udGFpbnMoXCJmb3JtYXR0aW5nLWxpbmstZW5kXCIpIHx8IG5hbWUuY29udGFpbnMoXCJmb3JtYXR0aW5nLWxpbmstc3RyaW5nXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghbmFtZS5jb250YWlucyhcImVuZFwiKSAmJiBlbmQgPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZCA9IC0yO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kID0gbm9kZS50bztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGN1cnNvclJhbmdlID0gdmlldy5zdGF0ZS5zZWxlY3Rpb24ubWFpbjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGFydCA+IGN1cnNvclJhbmdlLnRvIHx8IGVuZCA8IGN1cnNvclJhbmdlLmZyb20pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3V0TGlua1RleHQgJiYgb3V0TGlua01hdGhMaW5rKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ1aWxkZXIuYWRkKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWNvcmF0aW9uLndpZGdldCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkZ2V0OiBuZXcgTWF0aFdpZGdldChvdXRMaW5rVGV4dCwgb3V0TGlua01hdGhMaW5rLnJlcGxhY2UoL1xcXFxcXCQvLCBcIiRcIikpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydCA9IC0xO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kID0gLTE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRMaW5rVGV4dCA9IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdXRMaW5rTWF0aExpbmsgPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWxpYXM6IE1hdGhMaW5rXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoIW5hbWUuY29udGFpbnMoXCJwaXBlXCIpICYmICgobmFtZS5jb250YWlucyhcImhtZC1pbnRlcm5hbC1saW5rXCIpICYmIG5hbWUuY29udGFpbnMoXCJhbGlhc1wiKSkgfHwgKG5hbWUuY29udGFpbnMoXCJobWQtZXNjYXBlXCIpICYmIG5hbWUuY29udGFpbnMoXCJsaW5rXCIpKSB8fCAvXmxpbmsvLnRlc3QobmFtZSkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG91dExpbmtNYXRoTGluayArPSB2aWV3LnN0YXRlLmRvYy5zbGljZVN0cmluZyhub2RlLmZyb20sIG5vZGUudG8pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobGVhZlZpZXcuZmlsZSAmJiBvdXRMaW5rTWF0aExpbmsgPT0gb3V0TGlua1RleHQucmVwbGFjZSgvXFwubWQvLCBcIlwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3V0TGlua01hdGhMaW5rID0gZ2V0TWF0aExpbmsocGx1Z2luLCBvdXRMaW5rVGV4dCwgbGVhZlZpZXcuZmlsZS5wYXRoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGJ1aWxkZXIuZmluaXNoKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIHsgZGVjb3JhdGlvbnM6IHYgPT4gdi5kZWNvcmF0aW9ucyB9XG4gICAgKTtcblxuICAgIHJldHVybiBuZXcgUHJvbWlzZTxWaWV3UGx1Z2luPFY+PigocmVzb2x2ZSkgPT4geyByZXNvbHZlKHZpZXdQbHVnaW4pIH0pO1xufVxuIiwgImltcG9ydCB7IFRGaWxlIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgTWF0aExpbmtzIGZyb20gXCIuLi9tYWluXCI7XG5cbmV4cG9ydCBmdW5jdGlvbiBhZGRTdXBlckNoYXJnZWQocGx1Z2luOiBNYXRoTGlua3MsIHNwYW46IEhUTUxFbGVtZW50LCBvdXRMaW5rRmlsZTogVEZpbGUpOiB2b2lkIHtcbiAgICBpZiAob3V0TGlua0ZpbGUgJiYgcGx1Z2luLmFwcC5wbHVnaW5zLmVuYWJsZWRQbHVnaW5zLmhhcyhcInN1cGVyY2hhcmdlZC1saW5rcy1vYnNpZGlhblwiKSkge1xuICAgICAgICBsZXQgc3VwZXJDaGFyZ2VkID0gZ2V0U3VwZXJDaGFyZ2VkKHBsdWdpbiwgb3V0TGlua0ZpbGUpO1xuICAgICAgICBzcGFuLmNsYXNzTGlzdC5hZGQoXCJkYXRhLWxpbmstaWNvblwiKTtcbiAgICAgICAgc3Bhbi5jbGFzc0xpc3QuYWRkKFwiZGF0YS1saW5rLWljb24tYWZ0ZXJcIik7XG4gICAgICAgIHNwYW4uY2xhc3NMaXN0LmFkZChcImRhdGEtbGluay10ZXh0XCIpO1xuICAgICAgICBzcGFuLnNldEF0dHJpYnV0ZShcImRhdGEtbGluay1wYXRoXCIsIG91dExpbmtGaWxlLnBhdGgpO1xuICAgICAgICBzcGFuLnNldEF0dHJpYnV0ZShcImRhdGEtbGluay10YWdzXCIsIHN1cGVyQ2hhcmdlZFswXSk7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3VwZXJDaGFyZ2VkWzFdLmxlbmd0aDsgaSsrKVxuICAgICAgICAgICAgc3Bhbi5zZXRBdHRyaWJ1dGUoXCJkYXRhLWxpbmstXCIgKyBzdXBlckNoYXJnZWRbMV1baV1bMF0sIHN1cGVyQ2hhcmdlZFsxXVtpXVsxXSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBnZXRTdXBlckNoYXJnZWQocGx1Z2luOiBNYXRoTGlua3MsIGZpbGU6IFRGaWxlKTogW3N0cmluZywgW3N0cmluZywgc3RyaW5nXVtdXSB7XG4gICAgY29uc3QgZGF0YSA9IHBsdWdpbi5hcHAucGx1Z2lucy5wbHVnaW5zW1wic3VwZXJjaGFyZ2VkLWxpbmtzLW9ic2lkaWFuXCJdPy5zZXR0aW5ncztcblxuICAgIGxldCB0YWdBcnIgPSBwbHVnaW4uYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0RmlsZUNhY2hlKGZpbGUpPy50YWdzO1xuICAgIGxldCB0YWdzOiBzdHJpbmcgPSBcIlwiO1xuICAgIGlmICh0YWdBcnIpIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0YWdBcnIubGVuZ3RoOyBpKyspXG4gICAgICAgICAgICB0YWdzICs9IHRhZ0FycltpXS50YWcucmVwbGFjZSgvIy8sIFwiXCIpICsgXCIgXCI7XG4gICAgICAgIHRhZ3MgPSB0YWdzLnRyaW1FbmQoKTtcbiAgICB9XG5cbiAgICBsZXQgYXR0cmlidXRlczogW3N0cmluZywgc3RyaW5nXVtdID0gW107XG4gICAgbGV0IGZyb250bWF0dGVyID0gcGx1Z2luLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpbGVDYWNoZShmaWxlKT8uZnJvbnRtYXR0ZXI7XG4gICAgaWYgKGRhdGEpIHtcbiAgICAgICAgZm9yIChsZXQgYXR0ciBpbiBmcm9udG1hdHRlcikge1xuICAgICAgICAgICAgaWYgKGF0dHIgIT0gXCJtYXRoTGlua1wiICYmIGF0dHIgIT0gXCJwb3NpdGlvblwiKSB7XG4gICAgICAgICAgICAgICAgbGV0IHNlbGVjdG9ycyA9IGRhdGEuc2VsZWN0b3JzO1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2VsZWN0b3JzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzZWxlY3RvcnNbaV0ubmFtZSA9PSBhdHRyICYmIHNlbGVjdG9yc1tpXS52YWx1ZSA9PSBmcm9udG1hdHRlclthdHRyXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlcy5wdXNoKFthdHRyLCBmcm9udG1hdHRlclthdHRyXV0pO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNlbGVjdG9yc1tpXS50eXBlID09IFwidGFnXCIgJiYgc2VsZWN0b3JzW2ldLnZhbHVlID09IGZyb250bWF0dGVyW2F0dHJdICYmIGRhdGEudGFyZ2V0VGFncykge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlcy5wdXNoKFthdHRyLCBmcm9udG1hdHRlclthdHRyXV0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIFt0YWdzLCBhdHRyaWJ1dGVzXTtcbn1cbiJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLHVCQUE2RDs7O0FDa0J0RCxJQUFNLG1CQUFzQztBQUFBLEVBQy9DLFdBQVcsQ0FBQztBQUFBLEVBQ1osZUFBZSxDQUFDO0FBQUEsRUFDaEIsYUFBYTtBQUFBLEVBQ2IsMEJBQTBCO0FBQUEsRUFDMUIsV0FBVztBQUNmOzs7QUN4QkEsdUJBQXVEOzs7QUNBdkQsdUJBQThGOzs7QUNBOUYsc0JBQXVDO0FBSWhDLG9CQUFvQixRQUFtQixNQUE4QjtBQUN4RSxXQUFTLElBQUksR0FBRyxJQUFJLE9BQU8sU0FBUyxjQUFjLFFBQVEsS0FBSztBQUMzRCxRQUFJLFdBQVcsT0FBTyxJQUFJLE1BQU0sc0JBQXNCLE9BQU8sU0FBUyxjQUFjLEVBQUU7QUFDdEYsUUFBSSxZQUFZLG1CQUFtQixNQUFNLFFBQVE7QUFBRyxhQUFPO0FBQUEsRUFDL0Q7QUFFQSxTQUFPO0FBQ1g7QUFHTyx1QkFBdUIsWUFBNEI7QUFkMUQ7QUFlSSw2QkFBMkIsYUFBb0IsU0FBcUM7QUFDaEYsUUFBSSxTQUFTLFFBQVEsS0FBSyxXQUFVO0FBQ3BDLFFBQUk7QUFDQSxhQUFRLFFBQU8sS0FBSyxHQUFHLE9BQU8sVUFBVSxNQUFNLEdBQUcsT0FBTztBQUFBLEVBQ2hFO0FBRUEsTUFBSSxpQkFBaUI7QUFDckIsTUFBSSxlQUFlO0FBQ25CLE1BQUksc0JBQXNCLGtCQUFrQixZQUFZLGNBQWM7QUFDdEUsTUFBSSxvQkFBb0Isa0JBQWtCLFlBQVksWUFBWTtBQUNsRSxTQUFPLDBEQUF1QixzQkFBdkIsWUFBNEM7QUFDdkQ7QUFHTyw0QkFBNEIsT0FBc0IsT0FBK0I7QUFDcEYsTUFBSSxTQUFTO0FBQU8sV0FBTztBQUMzQixNQUFJLGlCQUFpQiwyQkFBVyxNQUFNLE9BQU87QUFBRyxXQUFPO0FBRXZELE1BQUksV0FBVyxNQUFNO0FBQ3JCLFNBQU8sTUFBTTtBQUNULFFBQUksWUFBWTtBQUFPLGFBQU87QUFDOUIsUUFBSSxVQUFVO0FBQ1YsVUFBSSxTQUFTLE9BQU87QUFBRyxlQUFPO0FBQzlCLGlCQUFXLFNBQVM7QUFBQSxJQUN4QjtBQUFBLEVBQ0o7QUFDSjs7O0FEbkNPLElBQU0saUJBQU4sY0FBNkIsdUJBQU07QUFBQSxFQUN0QyxZQUFZLEtBQWlCLFFBQW1CO0FBQzVDLFVBQU0sR0FBRztBQURnQjtBQUFBLEVBRTdCO0FBQUEsRUFFQSxTQUFTO0FBQ0wsU0FBSyxRQUFRO0FBQUEsRUFDakI7QUFBQSxFQUdBLEFBQU0sVUFBVTtBQUFBO0FBQ1osWUFBTSxFQUFFLGNBQWM7QUFDdEIsZ0JBQVUsTUFBTTtBQUNoQixnQkFBVSxTQUFTLE1BQU0sRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBRXZELFVBQUkseUJBQVEsU0FBUyxFQUNoQixRQUNHLGVBQWUsQ0FBQyxNQUFNO0FBQ2xCLFVBQUUsV0FBVyxFQUFFLE1BQU0sMEdBQTBHLENBQUM7QUFDaEksVUFBRSxTQUFTLFFBQVEsRUFBRSxNQUFNLElBQUksQ0FBQztBQUNoQyxVQUFFLFdBQVcsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUM1QixVQUFFLFNBQVMsUUFBUSxFQUFFLE1BQU0sSUFBSSxDQUFDO0FBQ2hDLFVBQUUsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDdEMsVUFBRSxTQUFTLFFBQVEsRUFBRSxNQUFNLElBQUksQ0FBQztBQUNoQyxVQUFFLFdBQVcsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUM1QixVQUFFLFNBQVMsUUFBUSxFQUFFLE1BQU0sSUFBSSxDQUFDO0FBQ2hDLFVBQUUsV0FBVyxFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDcEQsVUFBRSxTQUFTLFFBQVEsRUFBRSxNQUFNLElBQUksQ0FBQztBQUNoQyxVQUFFLFdBQVcsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUM1QixVQUFFLFNBQVMsUUFBUSxFQUFFLE1BQU0sSUFBSSxDQUFDO0FBQ2hDLFVBQUUsV0FBVyxFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFBQSxNQUM1RCxDQUFDLENBQ0wsRUFDQyxVQUFVLENBQUMsUUFBUTtBQUNoQixZQUFJLFdBQVcsS0FBSyxFQUFFLFFBQVEsTUFBTSxFQUMvQixRQUFRLENBQUMsVUFBVTtBQUNoQixjQUFJLGNBQXdCLEVBQUUsVUFBVSxJQUFJLGFBQWEsSUFBSSxhQUFhLE1BQU0sV0FBVyxNQUFNLE1BQU0sS0FBSztBQUM1RyxjQUFJLHNCQUFzQixLQUFLLEtBQUssS0FBSyxRQUFRLE1BQU0sYUFBYSxJQUFJLEVBQUUsS0FBSztBQUFBLFFBQ25GLENBQUM7QUFBQSxNQUNULENBQUM7QUFFTCxVQUFJLEtBQUssT0FBTyxTQUFTLFVBQVUsUUFBUTtBQUN2QyxZQUFJLE9BQU8sVUFBVSxTQUFTLElBQUk7QUFDbEMsaUJBQVMsSUFBSSxHQUFHLElBQUksS0FBSyxPQUFPLFNBQVMsVUFBVSxRQUFRLEtBQUs7QUFDNUQsY0FBSSxXQUFXLEtBQUssT0FBTyxTQUFTLFVBQVU7QUFDOUMsY0FBSSxPQUFPLEtBQUssU0FBUyxJQUFJLEVBQUUsVUFBVTtBQUV6QyxjQUFJLHlCQUFRLElBQUksRUFDWCxRQUNHLGVBQWUsQ0FBQyxNQUFNO0FBQ2xCLGNBQUUsU0FBUyxRQUFRLEVBQUUsTUFBTSxTQUFTLFNBQVMsQ0FBQztBQUM5QyxjQUFFLFdBQVcsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUM1QixjQUFFLFNBQVMsUUFBUSxFQUFFLE1BQU0sU0FBUyxZQUFZLENBQUM7QUFBQSxVQUNyRCxDQUFDLENBQ0wsRUFDQyxlQUFlLENBQUMsV0FBdUQ7QUFDcEUsbUJBQU8sT0FBTyxXQUFXLFNBQVMsRUFBRSxRQUFRLG9CQUFvQixFQUFFLFFBQVEsTUFBWTtBQUNsRixrQkFBSSxLQUFLLEdBQUc7QUFDUixvQkFBSSxPQUFPLG1CQUFJO0FBQ2Ysb0JBQUksS0FBSyxLQUFLLE9BQU8sU0FBUyxVQUFVLElBQUk7QUFFNUMscUJBQUssT0FBTyxTQUFTLFVBQVUsS0FBSztBQUNwQyxxQkFBSyxPQUFPLFNBQVMsVUFBVSxJQUFJLEtBQUs7QUFDeEMsc0JBQU0sS0FBSyxPQUFPLGFBQWEsRUFBRSxLQUFLLE1BQU07QUFDeEMsdUJBQUssUUFBUTtBQUFBLGdCQUNqQixDQUFDO0FBQUEsY0FDTDtBQUFBLFlBQ0osRUFBQztBQUFBLFVBQ0wsQ0FBQyxFQUNBLGVBQWUsQ0FBQyxXQUF1RDtBQUNwRSxtQkFBTyxPQUFPLFdBQVcsV0FBVyxFQUFFLFFBQVEsc0JBQXNCLEVBQUUsUUFBUSxNQUFZO0FBQ3RGLGtCQUFJLEtBQUssS0FBSyxPQUFPLFNBQVMsVUFBVSxTQUFTLEdBQUc7QUFDaEQsb0JBQUksS0FBSyxtQkFBSTtBQUNiLG9CQUFJLE9BQU8sS0FBSyxPQUFPLFNBQVMsVUFBVSxJQUFJO0FBRTlDLHFCQUFLLE9BQU8sU0FBUyxVQUFVLEtBQUs7QUFDcEMscUJBQUssT0FBTyxTQUFTLFVBQVUsSUFBRSxLQUFLO0FBQ3RDLHNCQUFNLEtBQUssT0FBTyxhQUFhLEVBQUUsS0FBSyxNQUFNO0FBQ3hDLHVCQUFLLFFBQVE7QUFBQSxnQkFDakIsQ0FBQztBQUFBLGNBQ0w7QUFBQSxZQUNKLEVBQUM7QUFBQSxVQUNMLENBQUMsRUFDQSxlQUFlLENBQUMsV0FBdUQ7QUFDcEUsbUJBQU8sT0FBTyxXQUFXLE1BQU0sRUFBRSxRQUFRLE1BQU0sRUFBRSxRQUFRLE1BQVk7QUFDakUsa0JBQUksUUFBUSxJQUFJLHNCQUFzQixLQUFLLEtBQUssS0FBSyxRQUFRLE1BQU0sVUFBVSxLQUFLO0FBQ2xGLG9CQUFNLEtBQUs7QUFDWCxvQkFBTSxVQUFVLE1BQVk7QUFDeEIsc0JBQU0sS0FBSyxPQUFPLGFBQWEsRUFBRSxLQUFLLE1BQU07QUFDeEMsdUJBQUssUUFBUTtBQUFBLGdCQUNqQixDQUFDO0FBQUEsY0FDTDtBQUFBLFlBQ0osRUFBQztBQUFBLFVBQ0wsQ0FBQyxFQUNBLGVBQWUsQ0FBQyxXQUF1RDtBQUNwRSxtQkFBTyxPQUFPLFdBQVcsUUFBUSxFQUFFLFFBQVEsR0FBRyxFQUFFLFFBQVEsTUFBWTtBQUNoRSxtQkFBSyxPQUFPLFNBQVMsVUFBVSxPQUFPLFFBQVE7QUFDOUMsb0JBQU0sS0FBSyxPQUFPLGFBQWEsRUFBRSxLQUFLLE1BQU07QUFDeEMscUJBQUssUUFBUTtBQUFBLGNBQ2pCLENBQUM7QUFBQSxZQUNMLEVBQUM7QUFBQSxVQUNMLENBQUM7QUFBQSxRQUNUO0FBQUEsTUFDSjtBQUFBLElBQ0o7QUFBQTtBQUNKO0FBRUEsSUFBTSx3QkFBTixjQUFvQyx1QkFBTTtBQUFBLEVBQ3RDLFlBQVksS0FBaUIsUUFBMEIsT0FBOEIsVUFBMkIsUUFBaUI7QUFDN0gsVUFBTSxHQUFHO0FBRGdCO0FBQTBCO0FBQThCO0FBQTJCO0FBQUEsRUFFaEg7QUFBQSxFQUVBLFNBQVM7QUFDTCxTQUFLLFFBQVE7QUFBQSxFQUNqQjtBQUFBLEVBRUEsQUFBTSxVQUFVO0FBQUE7QUFDWixZQUFNLEVBQUUsY0FBYztBQUN0QixnQkFBVSxNQUFNO0FBRWhCLFVBQUk7QUFDSixVQUFJLHlCQUFRLFNBQVMsRUFDaEIsUUFBUSxjQUFjLEVBQ3RCLFFBQVEsMERBQTBELEVBQ2xFLFFBQVEsQ0FBQyxTQUFTO0FBQ2YsdUJBQWU7QUFDZixxQkFBYSxTQUFTLEtBQUssU0FBUyxRQUFRLEVBQUUsU0FBUyxDQUFDLFlBQVk7QUFDaEUsZUFBSyxTQUFTLFdBQVc7QUFBQSxRQUM3QixDQUFDO0FBQUEsTUFDTCxDQUFDO0FBRUwsVUFBSTtBQUNKLFVBQUkseUJBQVEsU0FBUyxFQUNoQixRQUFRLGlCQUFpQixFQUN6QixRQUFRLHVEQUF1RCxFQUMvRCxRQUFRLENBQUMsU0FBUztBQUNmLDBCQUFrQjtBQUNsQix3QkFBZ0IsU0FBUyxLQUFLLFNBQVMsV0FBVyxFQUFFLFNBQVMsQ0FBQyxZQUFZO0FBQ3RFLGVBQUssU0FBUyxjQUFjO0FBQUEsUUFDaEMsQ0FBQztBQUFBLE1BQ0wsQ0FBQztBQUVMLFVBQUkseUJBQVEsU0FBUyxFQUNoQixRQUFRLGNBQWMsRUFDdEIsUUFBUSxrREFBa0QsRUFDMUQsVUFBVSxDQUFDLFdBQVc7QUFDbkIsZUFBTyxTQUFTLEtBQUssU0FBUyxXQUFXLEVBQUUsU0FBUyxDQUFDLFlBQWEsS0FBSyxTQUFTLGNBQWMsT0FBUTtBQUFBLE1BQzFHLENBQUM7QUFFTCxVQUFJLHlCQUFRLFNBQVMsRUFDaEIsUUFBUSxnQkFBZ0IsRUFDeEIsUUFBUSxpQ0FBaUMsRUFDekMsVUFBVSxDQUFDLFdBQVc7QUFDbkIsZUFBTyxTQUFTLEtBQUssU0FBUyxTQUFTLEVBQUUsU0FBUyxDQUFDLFlBQWEsS0FBSyxTQUFTLFlBQVksT0FBUTtBQUFBLE1BQ3RHLENBQUM7QUFFTCxVQUFJLHlCQUFRLFNBQVMsRUFDaEIsUUFBUSxtQkFBbUIsRUFDM0IsUUFBUSx5QkFBeUIsRUFDakMsVUFBVSxDQUFDLFdBQVc7QUFDbkIsZUFBTyxTQUFTLEtBQUssU0FBUyxJQUFJLEVBQUUsU0FBUyxDQUFDLFlBQWEsS0FBSyxTQUFTLE9BQU8sT0FBUTtBQUFBLE1BQzVGLENBQUM7QUFFTCxVQUFJLHlCQUFRLFNBQVMsRUFDaEIsVUFBVSxDQUFDLE1BQU07QUFDZCxVQUFFLFdBQVcsS0FBSyxTQUFTLFFBQVEsTUFBTSxFQUFFLFFBQVEsV0FBVyxFQUFFLFFBQVEsTUFBWTtBQUNoRixjQUFJLEtBQUssU0FBUyxZQUFZLElBQUk7QUFDOUIsZ0JBQUksd0JBQU8sMkRBQTJEO0FBQUEsVUFDMUUsT0FBTztBQUNILGdCQUFJLEtBQUs7QUFBUSxtQkFBSyxPQUFPLFNBQVMsVUFBVSxLQUFLLEtBQUssUUFBUTtBQUNsRSxrQkFBTSxLQUFLLE9BQU8sYUFBYSxFQUFFLEtBQUssTUFBTTtBQUN4QyxtQkFBSyxNQUFNO0FBQ1gsbUJBQUssTUFBTSxRQUFRO0FBQUEsWUFDdkIsQ0FBQztBQUFBLFVBQ0w7QUFBQSxRQUNKLEVBQUM7QUFBQSxNQUNMLENBQUMsRUFDQSxlQUFlLENBQUMsTUFBNEI7QUFDekMsVUFBRSxXQUFXLFFBQVEsRUFBRSxRQUFRLE9BQU8sRUFBRSxRQUFRLE1BQVk7QUFDeEQsZUFBSyxNQUFNO0FBQUEsUUFDZixFQUFDO0FBQUEsTUFDTCxDQUFDO0FBQUEsSUFDVDtBQUFBO0FBQ0o7QUFFTyxJQUFNLGVBQU4sY0FBMkIsdUJBQU07QUFBQSxFQUNwQyxZQUFZLEtBQWlCLFFBQW1CO0FBQzVDLFVBQU0sR0FBRztBQURnQjtBQUFBLEVBRTdCO0FBQUEsRUFFQSxTQUFTO0FBQ0wsU0FBSyxRQUFRO0FBQUEsRUFDakI7QUFBQSxFQUdBLEFBQU0sVUFBVTtBQUFBO0FBQ1osWUFBTSxFQUFFLGNBQWM7QUFDdEIsZ0JBQVUsTUFBTTtBQUNoQixnQkFBVSxTQUFTLE1BQU0sRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBRW5ELFVBQUkseUJBQVEsU0FBUyxFQUNoQixRQUFRLDhEQUE4RCxFQUN0RSxVQUFVLENBQUMsUUFBUTtBQUNoQixZQUFJLFdBQVcsS0FBSyxFQUFFLFFBQVEsTUFBTSxFQUMvQixRQUFRLENBQUMsVUFBVTtBQUNoQixjQUFJLHdCQUF3QixLQUFLLEtBQUssS0FBSyxRQUFRLElBQUksRUFBRSxLQUFLO0FBQUEsUUFDbEUsQ0FBQztBQUFBLE1BQ1QsQ0FBQztBQUVMLFVBQUksS0FBSyxPQUFPLFNBQVMsY0FBYyxRQUFRO0FBQzNDLFlBQUksT0FBTyxVQUFVLFNBQVMsSUFBSTtBQUNsQyxpQkFBUyxRQUFRLEtBQUssT0FBTyxTQUFTLGVBQWU7QUFDakQsY0FBSSxPQUFPLEtBQUssU0FBUyxJQUFJLEVBQUUsVUFBVTtBQUN6QyxjQUFJLHlCQUFRLElBQUksRUFBRSxRQUFRLElBQUksRUFBRSxlQUFlLENBQUMsV0FBdUQ7QUFDbkcsbUJBQU8sT0FBTyxXQUFXLFFBQVEsRUFBRSxRQUFRLEdBQUcsRUFBRSxRQUFRLE1BQVk7QUFDaEUsbUJBQUssT0FBTyxTQUFTLGNBQWMsT0FBTyxJQUFJO0FBQzlDLG9CQUFNLEtBQUssT0FBTyxhQUFhLEVBQUUsS0FBSyxNQUFNO0FBQ3hDLHFCQUFLLFFBQVE7QUFBQSxjQUNqQixDQUFDO0FBQUEsWUFDTCxFQUFDO0FBQUEsVUFDTCxDQUFDO0FBQUEsUUFDTDtBQUFBLE1BQ0o7QUFBQSxJQUNKO0FBQUE7QUFDSjtBQUVBLElBQWUsbUJBQWYsY0FBd0MsbUNBQWlDO0FBQUEsRUFDckUsWUFBWSxLQUFpQixRQUFtQjtBQUM1QyxVQUFNLEdBQUc7QUFEZ0I7QUFBQSxFQUU3QjtBQUFBLEVBRUEsV0FBNEI7QUFDeEIsV0FBTyxLQUFLLElBQUksTUFBTSxrQkFBa0IsRUFBRSxPQUFPLEtBQUssZUFBZSxLQUFLLElBQUksQ0FBQztBQUFBLEVBQ25GO0FBQUEsRUFFQSxZQUFZLE1BQTZCO0FBQ3JDLFdBQU8sS0FBSztBQUFBLEVBQ2hCO0FBQUEsRUFFQSxlQUFlLGNBQXNDO0FBQ2pELFFBQUksd0JBQXdCLDBCQUFTLGFBQWEsYUFBYTtBQUFNLGFBQU87QUFDNUUsUUFBSSx3QkFBd0IsNEJBQVcsYUFBYSxPQUFPO0FBQUcsYUFBTztBQUVyRSxlQUFXLFFBQVEsS0FBSyxPQUFPLFNBQVMsZUFBZTtBQUNuRCxZQUFNLE9BQU8sS0FBSyxJQUFJLE1BQU0sc0JBQXNCLElBQUk7QUFDdEQsVUFBSSxRQUFRLG1CQUFtQixjQUFjLElBQUksR0FBRztBQUNoRCxlQUFPO0FBQUEsTUFDWDtBQUFBLElBQ0o7QUFFQSxXQUFPO0FBQUEsRUFDWDtBQUNKO0FBRUEsSUFBTSwwQkFBTixjQUFzQyxpQkFBaUI7QUFBQSxFQUNuRCxZQUFZLEtBQVUsUUFBMEIsT0FBcUI7QUFDakUsVUFBTSxLQUFLLE1BQU07QUFEMkI7QUFBQSxFQUVoRDtBQUFBLEVBRUEsQUFBTSxhQUFhLE1BQXFCLEtBQWlDO0FBQUE7QUFDckUsV0FBSyxPQUFPLFNBQVMsY0FBYyxLQUFLLEtBQUssSUFBSTtBQUNqRCxZQUFNLEtBQUssT0FBTyxhQUFhLEVBQUUsS0FBSyxNQUFNO0FBQ3hDLGFBQUssTUFBTSxRQUFRO0FBQUEsTUFDdkIsQ0FBQztBQUFBLElBQ0w7QUFBQTtBQUNKOzs7QUQxUU8sSUFBTSxzQkFBTixjQUFrQyxrQ0FBaUI7QUFBQSxFQUN0RCxZQUFZLEtBQWlCLFFBQW1CO0FBQzVDLFVBQU0sS0FBSyxNQUFNO0FBRFE7QUFBQSxFQUU3QjtBQUFBLEVBRUEsQUFBTSxVQUF5QjtBQUFBO0FBQzNCLFlBQU0sRUFBRSxnQkFBZ0I7QUFFeEIsa0JBQVksTUFBTTtBQUNsQixrQkFBWSxTQUFTLE1BQU0sRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBR3pELFVBQUkseUJBQVEsV0FBVyxFQUNsQixRQUFRLFdBQVcsRUFDbkIsUUFDRyxlQUFlLENBQUMsTUFBTTtBQUNsQixVQUFFLFdBQVcsRUFBRSxNQUFNLDJDQUEyQyxDQUFDO0FBQ2pFLFVBQUUsU0FBUyxRQUFRLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUM3QyxVQUFFLFdBQVcsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQUEsTUFDekQsQ0FBQyxDQUNMLEVBQ0MsVUFBVSxDQUFDLFdBQTZDO0FBQ3JELGVBQU8sT0FBTyxjQUFjLFFBQVEsRUFBRSxRQUFRLE1BQVk7QUFDdEQsY0FBSSxRQUFRLElBQUksZUFBZSxLQUFLLEtBQUssS0FBSyxNQUFNO0FBQ3BELGdCQUFNLEtBQUs7QUFDWCxnQkFBTSxVQUFVLE1BQVk7QUFDeEIsa0JBQU0sS0FBSyxPQUFPLGFBQWEsRUFBRSxLQUFLLE1BQU07QUFDeEMsbUJBQUssUUFBUTtBQUFBLFlBQ2pCLENBQUM7QUFBQSxVQUNMO0FBQUEsUUFDSixFQUFDO0FBQUEsTUFDTCxDQUFDO0FBR0wsVUFBSSx5QkFBUSxXQUFXLEVBQ2xCLFFBQVEsZ0JBQWdCLEVBQ3hCLFFBQVEsZ0RBQWdELEVBQ3hELFVBQVUsQ0FBQyxXQUE2QztBQUNyRCxlQUFPLE9BQU8sY0FBYyxRQUFRLEVBQUUsUUFBUSxNQUFZO0FBQ3RELGNBQUksUUFBUSxJQUFJLGFBQWEsS0FBSyxLQUFLLEtBQUssTUFBTTtBQUNsRCxnQkFBTSxLQUFLO0FBQ1gsZ0JBQU0sVUFBVSxNQUFZO0FBQ3hCLGtCQUFNLEtBQUssT0FBTyxhQUFhLEVBQUUsS0FBSyxNQUFNO0FBQ3hDLG1CQUFLLFFBQVE7QUFBQSxZQUNqQixDQUFDO0FBQUEsVUFDTDtBQUFBLFFBQ0osRUFBQztBQUFBLE1BQ0wsQ0FBQztBQUdMLFVBQUk7QUFDSixVQUFJLHlCQUFRLFdBQVcsRUFDbEIsUUFBUSw2QkFBNkIsRUFDckMsUUFDRyxlQUFlLENBQUMsTUFBTTtBQUNsQixVQUFFLFdBQVcsRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUNwQyxVQUFFLFNBQVMsUUFBUSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDN0MsVUFBRSxXQUFXLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUM3QyxZQUFJLEtBQUssT0FBTyxTQUFTLDBCQUEwQjtBQUMvQyxZQUFFLFNBQVMsUUFBUSxFQUFFLE1BQU0sWUFBWSxLQUFLLE9BQU8sU0FBUyxjQUFjLFdBQVcsQ0FBQztBQUFBLFFBQzFGLE9BQU87QUFDSCxZQUFFLFNBQVMsUUFBUSxFQUFFLE1BQU0sS0FBSyxPQUFPLFNBQVMsY0FBYyxXQUFXLENBQUM7QUFBQSxRQUM5RTtBQUNBLFVBQUUsV0FBVyxFQUFFLE1BQU0sSUFBSSxDQUFDO0FBQUEsTUFDOUIsQ0FBQyxDQUNMLEVBQ0MsUUFBUSxDQUFDLFNBQVM7QUFDZixpQkFBUztBQUNULGVBQU8sU0FBUyxLQUFLLE9BQU8sU0FBUyxXQUFXLEVBQUUsU0FBUyxDQUFPLFlBQW9CO0FBQ2xGLGVBQUssT0FBTyxTQUFTLGNBQWM7QUFDbkMsZ0JBQU0sS0FBSyxPQUFPLGFBQWE7QUFBQSxRQUNuQyxFQUFDO0FBQ0QsZUFBTyxlQUFlLHdCQUF3QjtBQUFBLE1BQ2xELENBQUMsRUFDQSxVQUFVLENBQUMsV0FBNEI7QUFDcEMsZUFBTyxTQUFTLEtBQUssT0FBTyxTQUFTLHdCQUF3QixFQUN4RCxTQUFTLENBQU8sVUFBbUI7QUFDaEMsZUFBSyxPQUFPLFNBQVMsMkJBQTJCO0FBQ2hELGdCQUFNLEtBQUssT0FBTyxhQUFhLEVBQUUsS0FBSyxNQUFNO0FBQ3hDLGlCQUFLLFFBQVE7QUFBQSxVQUNqQixDQUFDO0FBQUEsUUFDTCxFQUFDO0FBQ0wsZUFBTyxXQUFXLDhCQUE4QjtBQUFBLE1BQ3BELENBQUM7QUFHTCxVQUFJLHlCQUFRLFdBQVcsRUFDbEIsUUFBUSxzQkFBc0IsRUFDOUIsUUFDRyxlQUFlLENBQUMsTUFBTTtBQUNsQixZQUFJLFdBQVcsS0FBSyxPQUFPO0FBQzNCLFVBQUUsV0FBVyxFQUFFLE1BQU0sa0RBQWtELENBQUM7QUFDeEUsWUFBSSxTQUFTLFFBQVE7QUFDakIsY0FBSSxPQUFPLEVBQUUsU0FBUyxJQUFJO0FBQzFCLG1CQUFTLFdBQVcsVUFBVTtBQUMxQixpQkFBSyxTQUFTLE1BQU0sRUFBRSxNQUFNLFFBQVEsU0FBUyxLQUFLLENBQUM7QUFBQSxVQUN2RDtBQUFBLFFBQ0o7QUFBQSxNQUNKLENBQUMsQ0FDTCxFQUFFLFVBQVUsQ0FBQyxXQUE0QjtBQUNyQyxlQUFPLFNBQVMsS0FBSyxPQUFPLFNBQVMsU0FBUyxFQUN6QyxTQUFTLENBQU8sVUFBbUI7QUFDaEMsZUFBSyxPQUFPLFNBQVMsWUFBWTtBQUNqQyxnQkFBTSxLQUFLLE9BQU8sYUFBYSxFQUFFLEtBQUssTUFBTTtBQUN4QyxpQkFBSyxRQUFRO0FBQUEsVUFDakIsQ0FBQztBQUFBLFFBQ0wsRUFBQztBQUFBLE1BQ1QsQ0FBQztBQUFBLElBQ1Q7QUFBQTtBQUNKOzs7QUdsSEEsdUJBQWtIO0FBVTNHLElBQU0sc0JBQU4sTUFBMEI7QUFBQSxFQUc3QixZQUFtQixRQUEwQixVQUEyQyxhQUE0QixVQUE2SDtBQUE5TjtBQUEwQjtBQUEyQztBQUE0QjtBQUNoSCxTQUFLLGNBQWMsb0JBQUksSUFBSTtBQUFBLEVBQy9CO0FBQUEsRUFFQSxJQUFJLE1BQWEsU0FBc0M7QUFHbkQsUUFBSSxXQUFXLEtBQUssWUFBWSxJQUFJLElBQUk7QUFDeEMsUUFBSSxVQUFVO0FBQ1YsVUFBSSxZQUFZLFFBQVc7QUFDdkIsZUFBTyxTQUFTO0FBQUEsTUFDcEI7QUFDQSxVQUFJLFNBQVMsU0FBUztBQUN0QixVQUFJLFFBQVE7QUFDUixlQUFPLE9BQU87QUFBQSxNQUNsQjtBQUFBLElBQ0o7QUFBQSxFQUNKO0FBQUEsRUFFQSxPQUFPLE1BQWEsYUFBc0M7QUFDdEQsUUFBSSxLQUFLLGFBQWEsTUFBTTtBQUN4QixXQUFLLFlBQVksSUFBSSxNQUFNLE9BQU8sT0FBTyxDQUFDLEdBQUcsS0FBSyxZQUFZLElBQUksSUFBSSxHQUFHLFdBQVcsQ0FBQztBQUNyRixtQkFBYSxLQUFLLE9BQU8sS0FBSyxxQkFBcUIsTUFBTSxJQUFJO0FBQUEsSUFDakUsT0FBTztBQUNILFlBQU0sTUFBTSxrQkFBa0IsS0FBSyxTQUFTLG1DQUFtQyxLQUFLLG1CQUFtQjtBQUFBLElBQzNHO0FBQUEsRUFDSjtBQUFBLEVBRUEsT0FBTyxNQUFhLE9BQXNCO0FBS3RDLFFBQUksV0FBVyxLQUFLLFlBQVksSUFBSSxJQUFJO0FBQ3hDLFFBQUksVUFBVTtBQUNWLFVBQUksVUFBVSxRQUFXO0FBQ3JCLGFBQUssWUFBWSxPQUFPLElBQUk7QUFBQSxNQUNoQyxXQUFXLFNBQVMsY0FBYyxTQUFTLG1CQUFtQjtBQUMxRCxZQUFJLFNBQVMsV0FBVyxRQUFXO0FBQy9CLGlCQUFPLFNBQVM7QUFBQSxRQUNwQixPQUFPO0FBQ0gsZ0JBQU0sTUFBTSxrQkFBa0IsS0FBSyxTQUFTLDRCQUE0QixZQUFZLEtBQUssOEJBQThCO0FBQUEsUUFDM0g7QUFBQSxNQUNKLE9BQU87QUFDSCxZQUFJLFNBQVMsU0FBUztBQUN0QixZQUFJLFVBQVUsT0FBTyxXQUFXLFFBQVc7QUFDdkMsaUJBQU8sT0FBTztBQUFBLFFBQ2xCLE9BQU87QUFDSCxnQkFBTSxNQUFNLGtCQUFrQixLQUFLLFNBQVMsZ0RBQWdELEtBQUssU0FBUywrQkFBK0I7QUFBQSxRQUM3STtBQUFBLE1BQ0o7QUFBQSxJQUNKLE9BQU87QUFDSCxZQUFNLE1BQU0sa0JBQWtCLEtBQUssU0FBUyxzREFBc0QsS0FBSyw4QkFBOEI7QUFBQSxJQUN6STtBQUNBLGlCQUFhLEtBQUssT0FBTyxLQUFLLHFCQUFxQixNQUFNLElBQUk7QUFBQSxFQUNqRTtBQUNKO0FBR08sc0JBQXNCLEtBQVUsY0FBc0IsY0FBK0Q7QUFFeEgsTUFBSSxjQUFjLFFBQVEsV0FBVyxHQUFHLFlBQVk7QUFHcEQsTUFBSSxVQUFVLGtCQUFrQixDQUFDLFNBQXdCO0FBN0U3RDtBQThFUSxRQUFJLEtBQUssZ0JBQWdCLGlDQUFnQixLQUFLLEtBQUssUUFBUSxLQUFLLFVBQVU7QUFDdEUsaUJBQUssS0FBSyxPQUFPLE9BQWpCLG1CQUFxQjtBQUFBLElBQ3pCO0FBQUEsRUFDSixDQUFDO0FBQ0w7OztBQ2xGQSx1QkFBc0Y7OztBQ0F0Rix1QkFBNkg7QUFJdEgscUJBQXFCLFFBQWdCLFlBQXlCO0FBQ2pFLGFBQVcsZ0JBQWdCO0FBQzNCLFFBQU0sY0FBYztBQUNwQixNQUFJLFdBQVcsR0FBRyxTQUFTO0FBQzNCLE1BQUk7QUFDSixTQUFRLFVBQVMsWUFBWSxLQUFLLE1BQU0sT0FBTyxNQUFNO0FBQ2pELFVBQU0sYUFBYSxPQUFPO0FBQzFCLGFBQVMsT0FBTztBQUNoQixRQUFJLFNBQVM7QUFBVSxpQkFBVyxXQUFXLEVBQUUsWUFBWSxPQUFPLE1BQU0sVUFBVSxNQUFNLENBQUM7QUFFekYsVUFBTSxTQUFTLGlDQUFXLFlBQVksS0FBSztBQUMzQyxlQUFXLFdBQVcsRUFBRSxLQUFLLENBQUMsUUFBUSxlQUFlLFdBQVcsRUFBRSxDQUFDLEVBQUUsWUFBWSxNQUFNO0FBQ3ZGLDJDQUFpQjtBQUVqQixlQUFXLFlBQVk7QUFBQSxFQUMzQjtBQUVBLE1BQUksV0FBVyxPQUFPO0FBQVEsZUFBVyxXQUFXLEVBQUUsWUFBWSxPQUFPLE1BQU0sUUFBUSxDQUFDO0FBQzVGO0FBRU8scUJBQXFCLFFBQW1CLFlBQW9CLFlBQTRCO0FBeEIvRjtBQXlCSSxNQUFJLEVBQUUsTUFBTSxZQUFZLG9DQUFjLFVBQVU7QUFFaEQsTUFBSSxPQUFPLE9BQU8sSUFBSSxjQUFjLHFCQUFxQixNQUFNLFVBQVU7QUFDekUsTUFBSSxDQUFDO0FBQU0sV0FBTztBQUVsQixNQUFJLFFBQVEsT0FBTyxJQUFJLGNBQWMsYUFBYSxJQUFJO0FBQ3RELE1BQUksQ0FBQztBQUFPLFdBQU87QUFFbkIsTUFBSSxnQkFBZ0IscUNBQWUsT0FBTyxPQUFPO0FBRWpELE1BQUksV0FBVztBQUNmLE1BQUksZUFBZTtBQUNmLGVBQVcsdUJBQXVCLE1BQU0sZUFBZSxNQUFNLGFBQWEsT0FBTyxTQUFTLGFBR3RGLE9BQU8sU0FBUywyQkFBMkIsT0FBTyxFQUN0RDtBQUFBLEVBQ0osV0FBVyxNQUFNO0FBQ2IsZUFBVyxZQUFNLGdCQUFOLG1CQUFtQjtBQUM5QixRQUFJLFlBQVksUUFBUTtBQUNwQixpQkFBVyx5QkFBeUIsUUFBUSxJQUFJO0FBQUEsSUFDcEQ7QUFBQSxFQUNKO0FBRUEsTUFBSSxDQUFDLFlBQVksT0FBTyxTQUFTLFdBQVc7QUFDeEMsVUFBTSxhQUFhLE9BQU8sSUFBSSxNQUFNLHNCQUFzQixVQUFVO0FBQ3BFLFFBQUksc0JBQXNCLHdCQUFPO0FBQzdCLGVBQVMsV0FBVyxPQUFPLGFBQWE7QUFDcEMsY0FBTSxXQUFXLFFBQVEsWUFBWSxJQUFJLElBQUk7QUFDN0MsWUFBSSxVQUFVO0FBQ1YsY0FBSSxlQUFlO0FBQ2YsdUJBQVcsdUJBQXVCLE1BQU0sZUFBZSxVQUFVLFFBQVEsYUFFckUsUUFBUSxTQUFTLFlBQVksTUFBTSxhQUFhLENBQ3BEO0FBQUEsVUFDSixPQUFPO0FBQ0gsdUJBQVcsZUFBUyxnQkFBVCxZQUF3QjtBQUFBLFVBQ3ZDO0FBQUEsUUFDSjtBQUNBLFlBQUksVUFBVTtBQUNWO0FBQUEsUUFDSjtBQUFBLE1BQ0o7QUFBQSxJQUNKO0FBQUEsRUFDSjtBQUVBLFNBQU87QUFDWDtBQUVBLGdDQUFnQyxVQUFrQixlQUEwRCxVQUF5QyxhQUFxQixRQUErQjtBQTFFek07QUEyRUksTUFBSSxjQUFjO0FBQ2xCLE1BQUksY0FBYyxRQUFRLFdBQVc7QUFDakMsa0JBQWMsY0FBYyxRQUFRO0FBQUEsRUFDeEMsV0FBVyxjQUFjLFFBQVEsV0FBVyw0Q0FBVyx1QkFBWCxtQkFBZ0MsY0FBYyxNQUFNLE1BQUs7QUFDakcsa0JBQWMsY0FBYyxTQUFTLG1CQUFtQixjQUFjLE1BQU07QUFBQSxFQUNoRjtBQUNBLE1BQUksYUFBYTtBQUNiLFFBQUksV0FBVyxNQUFNO0FBQ2pCLFVBQUksVUFBVTtBQUNWLGVBQVEsNENBQVcsZ0JBQVgsWUFBMEIsWUFBWSxRQUFRO0FBQUEsTUFDMUQsT0FBTztBQUNILGVBQU87QUFBQSxNQUNYO0FBQUEsSUFDSixPQUFPO0FBQ0gsYUFBTyxTQUFTO0FBQUEsSUFDcEI7QUFBQSxFQUNKLE9BQU87QUFDSCxXQUFPO0FBQUEsRUFDWDtBQUNKO0FBRUEsa0NBQWtDLFFBQW1CLE1BQXFCO0FBQ3RFLE1BQUksWUFBWSxPQUFPLFNBQVM7QUFDaEMsTUFBSSxXQUFXLEtBQUssS0FBSyxRQUFRLFNBQVMsRUFBRTtBQUM1QyxXQUFTLElBQUksR0FBRyxJQUFJLFVBQVUsUUFBUSxLQUFLO0FBQ3ZDLFFBQUksV0FBVyxJQUFJLE9BQU8sVUFBVSxHQUFHLFFBQVE7QUFDL0MsUUFBSSxjQUFjLFVBQVUsR0FBRztBQUUvQixRQUFJLFFBQVE7QUFDWixRQUFJLFVBQVUsR0FBRztBQUFhLGVBQVM7QUFDdkMsUUFBSSxDQUFDLFVBQVUsR0FBRztBQUFXLGVBQVM7QUFFdEMsUUFBSSxVQUFVLEdBQUc7QUFDYixpQkFBVyxPQUFPLFNBQVMsT0FBTyxRQUFRLEtBQUssS0FBSyxFQUFFLFFBQVEsS0FBSyxLQUFLLEdBQUcsS0FBSztBQUFBO0FBRWhGLGlCQUFXLE9BQU8sU0FBUyxRQUFRLEtBQUs7QUFFNUMsZUFBVyxTQUFTLFFBQVEsVUFBVSxXQUFXO0FBQUEsRUFDckQ7QUFFQSxTQUFPO0FBQ1g7OztBRC9HTyxJQUFNLHVCQUFOLGNBQW1DLHFDQUFvQjtBQUFBLEVBSzFELFlBQVksYUFBaUMsUUFBMEIsWUFBMkIsWUFBMkIsYUFBcUI7QUFWdEo7QUFXUSxVQUFNLFdBQVc7QUFEd0I7QUFBMEI7QUFBMkI7QUFBMkI7QUFFekgsU0FBSyxhQUFhLEtBQUssT0FBTyxJQUFJLGNBQWMscUJBQXFCLGtDQUFZLEtBQUssVUFBVSxHQUFHLEtBQUssVUFBVTtBQUNsSCxTQUFLLGFBQWEsS0FBSyxZQUFZLFVBQVUsSUFBSTtBQUNqRCxTQUFLLFdBQVcsY0FBYztBQUM5QixlQUFLLFlBQVksZUFBakIsbUJBQTZCLGFBQWEsS0FBSyxZQUFZLEtBQUssWUFBWTtBQUM1RSxTQUFLLFdBQVcsVUFBVSxJQUFJLHdCQUF3QjtBQUN0RCxTQUFLLFlBQVksVUFBVSxJQUFJLHdCQUF3QjtBQUN2RCxTQUFLLFlBQVksTUFBTSxVQUFVO0FBQ2pDLFNBQUssY0FBYyxLQUFLLGtCQUFrQjtBQUFBLEVBQzlDO0FBQUEsRUFFQSxTQUFlO0FBQ1gsU0FBSyxPQUFPO0FBR1osU0FBSyxPQUFPLGNBQWMsS0FBSyxPQUFPLElBQUksY0FBYyxHQUFHLFdBQVcsQ0FBQyxnQkFBZ0I7QUFDbkYsVUFBSSxDQUFDLEtBQUssY0FBYyxLQUFLLGNBQWMsYUFBYTtBQUNwRCxhQUFLLE9BQU87QUFBQSxNQUNoQjtBQUFBLElBQ0osQ0FBQyxDQUFDO0FBR0YsU0FBSyxPQUFPLGNBQWMsS0FBSyxPQUFPLElBQUksY0FBYyxHQUFHLHFCQUFxQixDQUFDLFlBQVksZ0JBQWdCO0FBQ3pHLFVBQUksQ0FBQyxLQUFLLGNBQWMsS0FBSyxjQUFjLGFBQWE7QUFDcEQsYUFBSyxPQUFPO0FBQUEsTUFDaEI7QUFBQSxJQUNKLENBQUMsQ0FBQztBQUdGLFNBQUssT0FBTyxjQUFjLEtBQUssT0FBTyxJQUFJLGNBQWMsR0FBRyw2QkFBNkIsQ0FBQyxlQUFlO0FBQ3BHLFdBQUssT0FBTztBQUFBLElBQ2hCLENBQUMsQ0FBQztBQUFBLEVBQ047QUFBQSxFQUVBLG9CQUFrQztBQTdDdEM7QUE4Q1EsUUFBSSxTQUFTLE1BQU07QUFDbkIsUUFBSSxLQUFLLGVBQWUsS0FBSyxjQUFjLEtBQUssZUFBZSxjQUFjLEtBQUssVUFBVSxHQUFHO0FBRTNGLGVBQVMsTUFBTSxLQUFLO0FBQUEsSUFDeEIsT0FBTztBQUNILFVBQUksS0FBSyxlQUFlLFlBQUssZUFBTCxtQkFBaUIsU0FBUSxLQUFLLGVBQWUsWUFBSyxlQUFMLG1CQUFpQixhQUFZLEtBQUssZUFBZSxjQUFjLEtBQUssVUFBVSxHQUFHO0FBRWxKLGlCQUFTLE1BQU0sWUFBWSxLQUFLLFFBQVEsS0FBSyxZQUFZLEtBQUssVUFBVTtBQUFBLE1BQzVFO0FBQUEsSUFDSjtBQUNBLFdBQU87QUFBQSxFQUNYO0FBQUEsRUFFQSxBQUFNLFNBQXdCO0FBQUE7QUFDMUIsWUFBTSxXQUFXLEtBQUssWUFBWTtBQUVsQyxVQUFJLFVBQVU7QUFDVixvQkFBWSxVQUFVLEtBQUssVUFBVTtBQUFBLE1BQ3pDLE9BQU87QUFDSCxvQkFBWSxLQUFLLGFBQWEsS0FBSyxVQUFVO0FBQUEsTUFDakQ7QUFBQSxJQUNKO0FBQUE7QUFDSjtBQUVPLDJCQUEyQixRQUFtQixTQUFzQixTQUE2QztBQXRFeEg7QUF1RUksV0FBUyxZQUFZLFFBQVEsaUJBQThCLGdCQUFnQixHQUFHO0FBQzFFLFFBQUksU0FBUyxVQUFVLFNBQVMsd0JBQXdCLEdBQUc7QUFDdkQsZUFBUyxPQUFPO0FBQ2hCLFVBQUksY0FBYyxRQUFRLGNBQTJCLHlCQUF5QjtBQUM5RSxVQUFJLGFBQWE7QUFDYixtQkFBVztBQUNYLGlCQUFTLFVBQVUsT0FBTyx3QkFBd0I7QUFDbEQsaUJBQVMsTUFBTSxVQUFVO0FBQUEsTUFDN0I7QUFBQSxJQUNKO0FBRUEsVUFBTSxnQkFBZ0IsZUFBUyxnQkFBVCxtQkFBc0IsT0FBTyxRQUFRLFFBQVE7QUFDbkUsUUFBSSxpQkFBaUIsTUFBTSxDQUFDLHdCQUF3QixLQUFLLFNBQVMsU0FBUyxHQUFHO0FBQzFFLFlBQU0sYUFBYSxlQUFTLGFBQWEsV0FBVyxNQUFqQyxtQkFBb0MsUUFBUSxRQUFRO0FBQ3ZFLFVBQUksWUFBWTtBQUNaLGNBQU0sYUFBYSxPQUFPLElBQUksY0FBYyxxQkFBcUIsa0NBQVksVUFBVSxHQUFHLFFBQVEsVUFBVTtBQUM1RyxZQUFJLGlCQUFpQixZQUFZO0FBQzdCLGdCQUFNLFFBQVEsSUFBSSxxQkFBcUIsVUFBVSxRQUFRLFFBQVEsWUFBWSxZQUFZLGFBQWE7QUFDdEcsa0JBQVEsU0FBUyxLQUFLO0FBQUEsUUFDMUI7QUFBQSxNQUNKO0FBQUEsSUFDSjtBQUFBLEVBQ0o7QUFDSjs7O0FFOUZBLHNCQUEyQjtBQUMzQixtQkFBZ0M7QUFDaEMsa0JBQXVHO0FBQ3ZHLHVCQUFrRjs7O0FDQTNFLHlCQUF5QixRQUFtQixNQUFtQixhQUEwQjtBQUM1RixNQUFJLGVBQWUsT0FBTyxJQUFJLFFBQVEsZUFBZSxJQUFJLDZCQUE2QixHQUFHO0FBQ3JGLFFBQUksZUFBZSxnQkFBZ0IsUUFBUSxXQUFXO0FBQ3RELFNBQUssVUFBVSxJQUFJLGdCQUFnQjtBQUNuQyxTQUFLLFVBQVUsSUFBSSxzQkFBc0I7QUFDekMsU0FBSyxVQUFVLElBQUksZ0JBQWdCO0FBQ25DLFNBQUssYUFBYSxrQkFBa0IsWUFBWSxJQUFJO0FBQ3BELFNBQUssYUFBYSxrQkFBa0IsYUFBYSxFQUFFO0FBQ25ELGFBQVMsSUFBSSxHQUFHLElBQUksYUFBYSxHQUFHLFFBQVE7QUFDeEMsV0FBSyxhQUFhLGVBQWUsYUFBYSxHQUFHLEdBQUcsSUFBSSxhQUFhLEdBQUcsR0FBRyxFQUFFO0FBQUEsRUFDckY7QUFDSjtBQUVBLHlCQUF5QixRQUFtQixNQUEyQztBQWhCdkY7QUFpQkksUUFBTSxPQUFPLGFBQU8sSUFBSSxRQUFRLFFBQVEsbUNBQTNCLG1CQUEyRDtBQUV4RSxNQUFJLFNBQVMsYUFBTyxJQUFJLGNBQWMsYUFBYSxJQUFJLE1BQTFDLG1CQUE2QztBQUMxRCxNQUFJLE9BQWU7QUFDbkIsTUFBSSxRQUFRO0FBQ1IsYUFBUyxJQUFJLEdBQUcsSUFBSSxPQUFPLFFBQVE7QUFDL0IsY0FBUSxPQUFPLEdBQUcsSUFBSSxRQUFRLEtBQUssRUFBRSxJQUFJO0FBQzdDLFdBQU8sS0FBSyxRQUFRO0FBQUEsRUFDeEI7QUFFQSxNQUFJLGFBQWlDLENBQUM7QUFDdEMsTUFBSSxjQUFjLGFBQU8sSUFBSSxjQUFjLGFBQWEsSUFBSSxNQUExQyxtQkFBNkM7QUFDL0QsTUFBSSxNQUFNO0FBQ04sYUFBUyxRQUFRLGFBQWE7QUFDMUIsVUFBSSxRQUFRLGNBQWMsUUFBUSxZQUFZO0FBQzFDLFlBQUksWUFBWSxLQUFLO0FBQ3JCLGlCQUFTLElBQUksR0FBRyxJQUFJLFVBQVUsUUFBUSxLQUFLO0FBQ3ZDLGNBQUksVUFBVSxHQUFHLFFBQVEsUUFBUSxVQUFVLEdBQUcsU0FBUyxZQUFZLE9BQU87QUFDdEUsdUJBQVcsS0FBSyxDQUFDLE1BQU0sWUFBWSxLQUFLLENBQUM7QUFBQSxVQUM3QyxXQUFXLFVBQVUsR0FBRyxRQUFRLFNBQVMsVUFBVSxHQUFHLFNBQVMsWUFBWSxTQUFTLEtBQUssWUFBWTtBQUNqRyx1QkFBVyxLQUFLLENBQUMsTUFBTSxZQUFZLEtBQUssQ0FBQztBQUFBLFVBQzdDO0FBQUEsUUFDSjtBQUFBLE1BQ0o7QUFBQSxJQUNKO0FBQUEsRUFDSjtBQUVBLFNBQU8sQ0FBQyxNQUFNLFVBQVU7QUFDNUI7OztBRHBDTywwQkFBaUQsUUFBbUIsTUFBNkM7QUFDcEgsTUFBSSxXQUFXLEtBQUs7QUFFcEIsUUFBTSxtQkFBbUIsdUJBQVc7QUFBQSxJQUNoQyxZQUFtQixhQUE0QixpQkFBeUI7QUFBRSxZQUFNO0FBQTdEO0FBQTRCO0FBQUEsSUFBb0M7QUFBQSxJQUVuRixRQUFRO0FBQ0osVUFBSSxXQUFXLFNBQVMsY0FBYyxNQUFNO0FBQzVDLGtCQUFZLEtBQUssaUJBQWlCLFFBQVE7QUFDMUMsZUFBUyxVQUFVLElBQUksY0FBYztBQUNyQyxlQUFTLGFBQWEsYUFBYSxNQUFNO0FBRXpDLFVBQUksY0FBYyxPQUFPLElBQUksY0FBYyxxQkFBcUIsS0FBSyxZQUFZLFFBQVEsUUFBUSxFQUFFLEdBQUcsRUFBRTtBQUN4RyxVQUFJO0FBQWEsd0JBQWdCLFFBQVEsVUFBVSxXQUFXO0FBRTlELFVBQUksa0JBQWtCLFNBQVMsY0FBYyxNQUFNO0FBQ25ELHNCQUFnQixVQUFVLElBQUksc0JBQXNCO0FBQ3BELHNCQUFnQixZQUFZLFFBQVE7QUFFcEMsVUFBSSxhQUFhO0FBQ2pCLFVBQUksU0FBUyxNQUFNO0FBQ2YscUJBQWEsU0FBUyxLQUFLO0FBQzNCLFlBQUksV0FBVyxTQUFTLFNBQVMsR0FBRztBQUNoQyxtQkFBUyxRQUFRLFNBQVMsT0FBTyxVQUFVLE9BQU8sR0FBRztBQUNqRCx5QkFBYSxLQUFLO0FBQ2xCO0FBQUEsVUFDSjtBQUFBLFFBQ0o7QUFBQSxNQUNKO0FBRUEsWUFBTSxhQUFhLE9BQU8sSUFBSSxjQUFjLHFCQUFxQixrQ0FBWSxLQUFLLFdBQVcsR0FBRyxVQUFVO0FBRTFHLHNCQUFnQixVQUFXLENBQUMsUUFBb0I7QUFDNUMsWUFBSSxlQUFlO0FBQ25CLFlBQUksWUFBWTtBQUNaLGlCQUFPLElBQUksVUFBVSxhQUFhLEtBQUssYUFBYSxZQUFZLHdCQUFPLFdBQVcsR0FBRyxDQUFDO0FBQUEsUUFDMUYsT0FBTztBQUNILGVBQUssS0FBSyxLQUFLLGFBQWEsVUFBVSxZQUFZO0FBQUEsUUFDdEQ7QUFBQSxNQUNKO0FBRUEsc0JBQWdCLGNBQWUsQ0FBQyxRQUFvQjtBQUNoRCxZQUFJLElBQUksVUFBVSxHQUFHO0FBQ2pCLGNBQUksZUFBZTtBQUFBLFFBQ3ZCO0FBQUEsTUFDSjtBQUVBLHNCQUFnQixhQUFjLENBQUMsUUFBb0I7QUFDL0MsWUFBSSxJQUFJLFVBQVUsR0FBRztBQUNqQixjQUFJLFlBQVk7QUFDWixtQkFBTyxJQUFJLFVBQVUsYUFBYSxLQUFLLGFBQWEsWUFBWSxJQUFJO0FBQUEsVUFDeEUsT0FBTztBQUNILGlCQUFLLEtBQUssS0FBSyxhQUFhLFVBQVUsWUFBWTtBQUFBLFVBQ3REO0FBQUEsUUFDSjtBQUFBLE1BQ0o7QUFFQSxhQUFPO0FBQUEsSUFDWDtBQUFBLEVBQ0o7QUFFQSxNQUFJLGFBQWEsdUJBQVcsVUFDeEIsTUFBTTtBQUFBLElBR0YsWUFBWSxNQUFrQjtBQUMxQixpQkFBVyxLQUFLO0FBQ2hCLFdBQUssdUJBQXVCLElBQUk7QUFBQSxJQUNwQztBQUFBLElBRUEsT0FBTyxRQUFvQjtBQUN2QixXQUFLLHVCQUF1QixPQUFPLElBQUk7QUFBQSxJQUMzQztBQUFBLElBRUEsdUJBQXVCLE1BQWtCO0FBQ3JDLFdBQUssY0FBYyx1QkFBVztBQUU5QixVQUFJLGFBQWEsS0FBSyxhQUFhO0FBRW5DLFVBQUksS0FBSyxnQkFBZ0IsaUNBQWdCLEtBQUssS0FBSyxnQkFBZ0IsMEJBQVMsV0FBVyxRQUFRLEtBQUssS0FBSyxJQUFJLEdBQUc7QUFDNUcsWUFBSSxVQUFVLEtBQUssS0FBSyxPQUFPO0FBQy9CLFlBQUksV0FBVyxRQUFRLFdBQVcsTUFBTSxRQUFRLFlBQVksQ0FBQyxXQUFXLE1BQU0sUUFBUTtBQUNsRixlQUFLLGNBQWMsS0FBSyxpQkFBaUIsSUFBSTtBQUFBLFFBQ2pELE9BQU87QUFDSCxlQUFLLGNBQWMsdUJBQVc7QUFBQSxRQUNsQztBQUFBLE1BQ0osV0FBVyxTQUFTLFFBQVE7QUFDeEIsaUJBQVMsUUFBUSxTQUFTLE9BQU8sVUFBVSxPQUFPLEdBQUc7QUFDakQsY0FBSSxXQUFXLFFBQVEsS0FBSyxJQUFJLEdBQUc7QUFDL0IsaUJBQUssY0FBYyxLQUFLLGlCQUFpQixJQUFJO0FBQUEsVUFDakQ7QUFBQSxRQUNKO0FBRUEsZUFBTyxJQUFJLFVBQVUsa0JBQWtCLENBQUMsY0FBNkI7QUFDakUsY0FBSSxVQUFVLGdCQUFnQiwrQkFBYztBQUN4QyxnQkFBSSxZQUFZLFVBQVUsS0FBSyxPQUFPO0FBQ3RDLGdCQUFJLGFBQWEsTUFBTTtBQUNuQixtQkFBSyxjQUFjLHVCQUFXO0FBQUEsWUFDbEM7QUFBQSxVQUNKO0FBQUEsUUFDSixDQUFDO0FBQUEsTUFDTDtBQUFBLElBQ0o7QUFBQSxJQUVBLGlCQUFpQixNQUFrQjtBQUMvQixVQUFJLFVBQVUsSUFBSSw2QkFBNEI7QUFFOUMsZUFBUyxFQUFFLE1BQU0sUUFBUSxLQUFLLGVBQWU7QUFDekMsWUFBSSxRQUFRLElBQUksTUFBTSxJQUFJLGNBQWMsSUFBSSxrQkFBa0I7QUFFOUQsd0NBQVcsS0FBSyxLQUFLLEVBQUUsUUFBUTtBQUFBLFVBQzNCO0FBQUEsVUFDQTtBQUFBLFVBQ0EsTUFBTSxNQUFNO0FBQ1IsZ0JBQUksT0FBTyxLQUFLLEtBQUs7QUFFckIsZ0JBQUksS0FBSyxTQUFTLHVDQUF1QyxHQUFHO0FBQ3hELHNCQUFRLEtBQUs7QUFBQSxZQUNqQixXQUdTLEtBQUssU0FBUyxpQ0FBaUMsR0FBRztBQUN2RCxrQkFBSSxTQUFTO0FBQUksd0JBQVEsS0FBSztBQUFBLFlBQ2xDLFdBR1MsS0FBSyxTQUFTLFdBQVcsR0FBRztBQUNqQyw2QkFBZSxLQUFLLE1BQU0sSUFBSSxZQUFZLEtBQUssTUFBTSxLQUFLLEVBQUU7QUFDNUQsa0JBQUksU0FBUyxRQUFRLG1CQUFtQixZQUFZLFFBQVEsUUFBUSxFQUFFLEdBQUc7QUFDckUsa0NBQWtCLFlBQVksUUFBUSxhQUFhLFNBQVMsS0FBSyxJQUFJO0FBQUEsY0FDekU7QUFBQSxZQUNKLFdBR1MsY0FBYyxLQUFLLElBQUksS0FBSyxDQUFDLEtBQUssU0FBUyxRQUFRLEdBQUc7QUFDM0QsNkJBQWUsVUFBVSxLQUFLLE1BQU0sSUFBSSxZQUFZLEtBQUssTUFBTSxLQUFLLEVBQUUsQ0FBQztBQUN2RSxrQkFBSSxTQUFTLFFBQVEsbUJBQW1CLFlBQVksUUFBUSxRQUFRLEVBQUUsR0FBRztBQUNyRSxrQ0FBa0IsWUFBWSxRQUFRLGFBQWEsU0FBUyxLQUFLLElBQUk7QUFBQSxjQUN6RTtBQUFBLFlBQ0osV0FHUyxTQUFTLFFBQVEsS0FBSyxTQUFTLG1CQUFtQixLQUFLLENBQUMsS0FBSyxTQUFTLE9BQU8sR0FBRztBQUNyRiw2QkFBZSxLQUFLLE1BQU0sSUFBSSxZQUFZLEtBQUssTUFBTSxLQUFLLEVBQUU7QUFDNUQsZ0NBQWtCLFlBQVksUUFBUSxhQUFhLFNBQVMsS0FBSyxJQUFJO0FBQUEsWUFDekUsV0FHUyxLQUFLLFNBQVMscUJBQXFCLEtBQUssS0FBSyxTQUFTLHdCQUF3QixHQUFHO0FBQ3RGLGtCQUFJLENBQUMsS0FBSyxTQUFTLEtBQUssS0FBSyxPQUFPLElBQUk7QUFDcEMsc0JBQU07QUFBQSxjQUNWLE9BQU87QUFDSCxzQkFBTSxLQUFLO0FBRVgsb0JBQUksY0FBYyxLQUFLLE1BQU0sVUFBVTtBQUN2QyxvQkFBSSxRQUFRLFlBQVksTUFBTSxNQUFNLFlBQVksTUFBTTtBQUNsRCxzQkFBSSxlQUFlLGlCQUFpQjtBQUNoQyw0QkFBUSxJQUNKLE9BQ0EsS0FDQSx1QkFBVyxPQUFPO0FBQUEsc0JBQ2QsUUFBUSxJQUFJLFdBQVcsYUFBYSxnQkFBZ0IsUUFBUSxRQUFRLEdBQUcsQ0FBQztBQUFBLG9CQUM1RSxDQUFDLENBQ0w7QUFBQSxrQkFDSjtBQUFBLGdCQUNKO0FBQ0Esd0JBQVE7QUFDUixzQkFBTTtBQUNOLDhCQUFjO0FBQ2Qsa0NBQWtCO0FBQUEsY0FDdEI7QUFBQSxZQUNKLFdBR1MsQ0FBQyxLQUFLLFNBQVMsTUFBTSxLQUFPLE1BQUssU0FBUyxtQkFBbUIsS0FBSyxLQUFLLFNBQVMsT0FBTyxLQUFPLEtBQUssU0FBUyxZQUFZLEtBQUssS0FBSyxTQUFTLE1BQU0sS0FBTSxRQUFRLEtBQUssSUFBSSxJQUFJO0FBQ2pMLGlDQUFtQixLQUFLLE1BQU0sSUFBSSxZQUFZLEtBQUssTUFBTSxLQUFLLEVBQUU7QUFDaEUsa0JBQUksU0FBUyxRQUFRLG1CQUFtQixZQUFZLFFBQVEsUUFBUSxFQUFFLEdBQUc7QUFDckUsa0NBQWtCLFlBQVksUUFBUSxhQUFhLFNBQVMsS0FBSyxJQUFJO0FBQUEsY0FDekU7QUFBQSxZQUNKO0FBQUEsVUFDSjtBQUFBLFFBQ0osQ0FBQztBQUFBLE1BQ0w7QUFFQSxhQUFPLFFBQVEsT0FBTztBQUFBLElBQzFCO0FBQUEsRUFDSixHQUFHLEVBQUUsYUFBYSxPQUFLLEVBQUUsWUFBWSxDQUN6QztBQUVBLFNBQU8sSUFBSSxRQUF1QixDQUFDLFlBQVk7QUFBRSxZQUFRLFVBQVU7QUFBQSxFQUFFLENBQUM7QUFDMUU7OztBUi9MQSxJQUFxQixZQUFyQixjQUF1Qyx3QkFBTztBQUFBLEVBSTFDLEFBQU0sU0FBUztBQUFBO0FBQ1gsWUFBTSxLQUFLLGFBQWE7QUFDeEIsWUFBTSxrQ0FBWTtBQUdsQixXQUFLLDhCQUE4QixDQUFDLFNBQVMsWUFBWTtBQUNyRCxZQUFJLE9BQU8sS0FBSyxJQUFJLE1BQU0sc0JBQXNCLFFBQVEsVUFBVTtBQUNsRSxZQUFJLFFBQVEsV0FBVyxNQUFNLElBQUksR0FBRztBQUNoQyw0QkFBa0IsTUFBTSxTQUFTLE9BQU87QUFBQSxRQUM1QztBQUFBLE1BQ0osQ0FBQztBQUdELFdBQUssSUFBSSxVQUFVLGNBQWMsTUFBTTtBQUNuQyxhQUFLLElBQUksVUFBVSxrQkFBa0IsQ0FBQyxTQUF3QjtBQUMxRCxjQUFJLEtBQUssZ0JBQWdCLDZCQUFZLEtBQUssS0FBSyxRQUFRLFdBQVcsTUFBTSxLQUFLLEtBQUssSUFBSSxHQUFHO0FBQ3JGLDZCQUFpQixNQUFNLElBQUksRUFBRSxLQUFLLENBQUMsZ0JBQWdCO0FBQy9DLG1CQUFLLHdCQUF3QixXQUFXO0FBQUEsWUFDNUMsQ0FBQztBQUFBLFVBQ0w7QUFBQSxRQUNKLENBQUM7QUFBQSxNQUNMLENBQUM7QUFHRCxXQUFLLElBQUksVUFBVSxHQUFHLHNCQUFzQixDQUFDLFNBQXdCO0FBQ2pFLFlBQUksS0FBSyxnQkFBZ0IsNkJBQVksS0FBSyxLQUFLLFFBQVEsV0FBVyxNQUFNLEtBQUssS0FBSyxJQUFJLEdBQUc7QUFDckYsMkJBQWlCLE1BQU0sSUFBSSxFQUFFLEtBQUssQ0FBQyxnQkFBZ0I7QUFDL0MsaUJBQUssd0JBQXdCLFdBQVc7QUFBQSxVQUM1QyxDQUFDO0FBQUEsUUFDTDtBQUFBLE1BQ0osQ0FBQztBQUVELFdBQUssY0FBYyxDQUFDO0FBQUEsSUFDeEI7QUFBQTtBQUFBLEVBRUEsY0FBeUMsWUFBdUQ7QUFDNUYsUUFBSSxVQUFVLEtBQUssWUFBWSxLQUFLLENBQUMsYUFBWSxTQUFRLFNBQVMsTUFBTSxXQUFXLFNBQVMsRUFBRTtBQUM5RixRQUFJO0FBQVMsYUFBTztBQUVwQixjQUFVLElBQUksb0JBQW9CLE1BQU0sV0FBVyxVQUFVLGlCQUFpQixhQUFhLE1BQU0sSUFBSTtBQUNyRyxTQUFLLFlBQVksS0FBSyxPQUFPO0FBQzdCLFdBQU87QUFBQSxFQUNYO0FBQUEsRUFFQSxBQUFNLGVBQWU7QUFBQTtBQUNqQixXQUFLLFdBQVcsT0FBTyxPQUFPLENBQUMsR0FBRyxrQkFBa0IsTUFBTSxLQUFLLFNBQVMsQ0FBQztBQUN6RSxXQUFLLGNBQWMsSUFBSSxvQkFBb0IsS0FBSyxLQUFLLElBQUksQ0FBQztBQUFBLElBQzlEO0FBQUE7QUFBQSxFQUVBLEFBQU0sZUFBZTtBQUFBO0FBQ2pCLFlBQU0sS0FBSyxTQUFTLEtBQUssUUFBUTtBQUFBLElBQ3JDO0FBQUE7QUFDSjsiLAogICJuYW1lcyI6IFtdCn0K
